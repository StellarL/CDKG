

<!DOCTYPE html>
<html>
<head>
    <title>全文阅读--XML全文阅读--中国知网</title>
    <link rel="icon" href="/kxreader/favicon.ico" />
    <link rel="shortcut Icon" href="/kxreader/favicon.ico" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="文献 XML KBASE CNKI 中国知网" />
    <meta name="description" content="XML文献检索" />
    <script type="text/javascript">
        var APPPATH = '/kxreader';
    </script>

</head>

<body>

    
<script type="text/javascript" src="//login.cnki.net/TopLogin/api/loginapi/get?type=top&amp;localCSS=&amp;returnurl=%2f%2fkns.cnki.net%2f%2fKXReader%2fDetail%3fTIMESTAMP%3d637129041517462500%26DBCODE%3dCJFD%26TABLEName%3dCJFDLAST2019%26FileName%3dJFYZ201904003%26RESULT%3d1%26SIGN%3dgCI%252blqhWFTjP75ifVaNtHLTTjPc%253d"></script>

<div id="headerBox" class="header">
    <div class="topbar">
        <div class="textalign">
            <a href="/kxreader/Detail?dbcode=CJFD&amp;filename=JFYZ201904003&amp;align=md">
                <i class="icon-cen active" title="居中对齐"></i>
            </a>
            <a href="/kxreader/Detail?dbcode=CJFD&amp;filename=JFYZ201904003&amp;align=lt">
                <i class="icon-left " title="左对齐"></i>
            </a>
        </div>
        <h6 class="free-tip"><i class="icon"></i>HTML阅读开放试用阶段，欢迎体验！</h6>
    </div>
</div>


    



<div class="btn-link" style="display: none"><a target="_blank" href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JFYZ201904003&amp;v=MDU1MDNVUkxPZVplUnFGQ25oVjd2SUx5dlNkTEc0SDlqTXE0OUZaNFFLREg4NHZSNFQ2ajU0TzN6cXFCdEdGckM=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">知网节</a></div>

    <div class="main">

        

    <div class="sidebar-a">
        <!--sidebar start-->
        <div class="sidenav">
            <div class="arrow"><span></span></div>
            <!--sidebar_list start-->
            <dl class="sidenav-list">
                    <dt class="tit">目录结构</dt>
                            <dd class="guide">
                                    <p><a href="#52" data-title="&lt;b&gt;1 相关工作&lt;/b&gt; "><b>1 相关工作</b></a><i></i></p>
                                                                    <ul class="contentbox">
                                                <li><a href="#57" data-title="&lt;b&gt;1.1 基于QEMU的反馈式静态翻译器FD-SQEMU&lt;/b&gt;"><b>1.1 基于QEMU的反馈式静态翻译器FD-SQEMU</b></a></li>
                                                <li><a href="#66" data-title="&lt;b&gt;1.2 TCG指令&lt;/b&gt;"><b>1.2 TCG指令</b></a></li>
                                    </ul>
                            </dd>
                            <dd class="guide">
                                    <p><a href="#72" data-title="&lt;b&gt;2 QEMU中TCG寄存器分配机制研究&lt;/b&gt; "><b>2 QEMU中TCG寄存器分配机制研究</b></a><i></i></p>
                                                                    <ul class="contentbox">
                                                <li><a href="#75" data-title="&lt;b&gt;2.1 QEMU中TCG寄存器分配机制&lt;/b&gt;"><b>2.1 QEMU中TCG寄存器分配机制</b></a></li>
                                                <li><a href="#80" data-title="&lt;b&gt;2.2 TCG寄存器分配机制的缺陷&lt;/b&gt;"><b>2.2 TCG寄存器分配机制的缺陷</b></a></li>
                                    </ul>
                            </dd>
                            <dd class="guide">
                                    <p><a href="#88" data-title="&lt;b&gt;3 基于优先级的动静结合寄存器分配算法&lt;/b&gt; "><b>3 基于优先级的动静结合寄存器分配算法</b></a><i></i></p>
                                                            </dd>
                            <dd class="guide">
                                    <p><a href="#130" data-title="&lt;b&gt;4 实验和结果&lt;/b&gt; "><b>4 实验和结果</b></a><i></i></p>
                                                                    <ul class="contentbox">
                                                <li><a href="#135" data-title="&lt;b&gt;4.1 实验环境&lt;/b&gt;"><b>4.1 实验环境</b></a></li>
                                                <li><a href="#139" data-title="&lt;b&gt;4.2 正确性测试&lt;/b&gt;"><b>4.2 正确性测试</b></a></li>
                                                <li><a href="#146" data-title="&lt;b&gt;4.3 寄存器分配相关信息分析&lt;/b&gt;"><b>4.3 寄存器分配相关信息分析</b></a></li>
                                                <li><a href="#152" data-title="&lt;b&gt;4.4 循环热代码性能测试&lt;/b&gt;"><b>4.4 循环热代码性能测试</b></a></li>
                                                <li><a href="#158" data-title="&lt;b&gt;4.5 递归热代码性能测试&lt;/b&gt;"><b>4.5 递归热代码性能测试</b></a></li>
                                                <li><a href="#161" data-title="&lt;b&gt;4.6 整体性能测试&lt;/b&gt;"><b>4.6 整体性能测试</b></a></li>
                                                <li><a href="#164" data-title="&lt;b&gt;4.7 实验结果分析&lt;/b&gt;"><b>4.7 实验结果分析</b></a></li>
                                    </ul>
                            </dd>
                            <dd class="guide">
                                    <p><a href="#166" data-title="&lt;b&gt;5 总 结&lt;/b&gt; "><b>5 总 结</b></a><i></i></p>
                                                            </dd>
                            <dd class="guide">
                                    <p><a href="#" data-title="文内图表 ">文内图表</a><i></i></p>
                                                                    <ul class="contentbox">
                                                <li><a href="#54" data-title="图1 QEMU翻译过程">图1 QEMU翻译过程</a></li>
                                                <li><a href="#59" data-title="图2 FD-SQEMU框架设计">图2 FD-SQEMU框架设计</a></li>
                                                <li><a href="#71" data-title="图3 临时变量内存布局">图3 临时变量内存布局</a></li>
                                                <li><a href="#77" data-title="图4 源体系寄存器到TCG虚拟寄存器的映射">图4 源体系寄存器到TCG虚拟寄存器的映射</a></li>
                                                <li><a href="#82" data-title="图5 TCG中间表示与翻译后的本地代码">图5 TCG中间表示与翻译后的本地代码</a></li>
                                                <li><a href="#84" data-title="图6 有关循环的寄存器分配例子">图6 有关循环的寄存器分配例子</a></li>
                                                <li><a href="#91" data-title="&lt;b&gt;表1 x86程序寄存器使用情况统计&lt;/b&gt;"><b>表1 x86程序寄存器使用情况统计</b></a></li>
                                                <li><a href="#95" data-title="图7 算法流程图">图7 算法流程图</a></li>
                                                <li><a href="#127" data-title="图8 部分算法伪代码">图8 部分算法伪代码</a></li>
                                                <li><a href="#144" data-title="&lt;b&gt;表2 指令翻译的正确性测试&lt;/b&gt;"><b>表2 指令翻译的正确性测试</b></a></li>
                                                <li><a href="#145" data-title="&lt;b&gt;表3 正确性测试&lt;/b&gt;"><b>表3 正确性测试</b></a></li>
                                                <li><a href="#148" data-title="&lt;b&gt;表4 优化前部分申威本地寄存器使用频率&lt;/b&gt;"><b>表4 优化前部分申威本地寄存器使用频率</b></a></li>
                                                <li><a href="#150" data-title="&lt;b&gt;表5 优化后部分申威本地寄存器使用频率&lt;/b&gt;"><b>表5 优化后部分申威本地寄存器使用频率</b></a></li>
                                                <li><a href="#156" data-title="&lt;b&gt;表6 NBENCH测试任务&lt;/b&gt;"><b>表6 NBENCH测试任务</b></a></li>
                                                <li><a href="#157" data-title="图9 优化后NBENCH加速情况">图9 优化后NBENCH加速情况</a></li>
                                                <li><a href="#160" data-title="图10 优化后递归热代码加速情况">图10 优化后递归热代码加速情况</a></li>
                                                <li><a href="#163" data-title="图11 优化后部分SPEC2006测试项的加速情况">图11 优化后部分SPEC2006测试项的加速情况</a></li>
                                    </ul>
                            </dd>
                                    <dd class="guide">
                                        <h6>
                                            <p><a href="#a_bibliography">参考文献</a> </p>
                                        </h6>
                                    </dd>

            </dl>
        </div>
        <!--sidebar end-->
        &nbsp;
        <!--此处有一空格符 勿删-->
    </div>

                <div class="sidebar-b three-collumn" style="width:0;">
            <div class="refer" style="width: 0;">
                <div class="arrow off" title="参考文献"><span></span></div>
                <div class="js-scrollbox" >
                    
                    <div class="subbox active">
                        <h4>
                            <span class="tit">参考文献</span>
                            <a class="close" href="javascript:void(0)">x</a>
                        </h4>
                        <div class="side-scroller">
                            <ul class="refer-list">
                                <li id="190">


                                    <a id="bibliography_1" title="Altman E R, Kaeli D, Sheffer Y.Welcome to the opportunities of binary translation[J].Computer, 2000, 33 (3) :40-45" target="_blank"
                                       href="http://scholar.cnki.net/result.aspx?q=Welcome to the opportunities of binary translation">
                                        <b>[1]</b>
                                        Altman E R, Kaeli D, Sheffer Y.Welcome to the opportunities of binary translation[J].Computer, 2000, 33 (3) :40-45
                                    </a>
                                </li>
                                <li id="192">


                                    <a id="bibliography_2" title="Shan Zheng, Guo Haoran, Pang Jianmin.BTMD:Aframework of binary translation based malcode detector[C]//Proc of the 4th Int Conf on Cyber-Enabled Distributed Computing and Knowledge Discovery.Los Alamitos, CA:IEEE Computer Society, 2012:39-43" target="_blank"
                                       href="http://scholar.cnki.net/result.aspx?q=BTMD:Aframework of binary translation based malcode detector">
                                        <b>[2]</b>
                                        Shan Zheng, Guo Haoran, Pang Jianmin.BTMD:Aframework of binary translation based malcode detector[C]//Proc of the 4th Int Conf on Cyber-Enabled Distributed Computing and Knowledge Discovery.Los Alamitos, CA:IEEE Computer Society, 2012:39-43
                                    </a>
                                </li>
                                <li id="194">


                                    <a id="bibliography_3" title="Ma Jinxin, Li Zhoujun, Hu Chaojian, et al.A reconstruction method of type abstraction in binary code[J].Journal of Computer Research and Development, 2013, 50 (11) :2418-2428 (in Chinese) (马金鑫, 李舟军, 忽朝俭, 等.一种重构二进制代码中类型抽象的方法[J].计算机研究与发展, 2013, 50 (11) :2418-2428) " target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JFYZ201311022&amp;v=MjU1OTlHRnJDVVJMT2VaZVJxRkNuaFY3dklMeXZTZExHNEg5TE5ybzlIWm9RS0RIODR2UjRUNmo1NE8zenFxQnQ=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[3]</b>
                                        Ma Jinxin, Li Zhoujun, Hu Chaojian, et al.A reconstruction method of type abstraction in binary code[J].Journal of Computer Research and Development, 2013, 50 (11) :2418-2428 (in Chinese) (马金鑫, 李舟军, 忽朝俭, 等.一种重构二进制代码中类型抽象的方法[J].计算机研究与发展, 2013, 50 (11) :2418-2428) 
                                    </a>
                                </li>
                                <li id="196">


                                    <a id="bibliography_4" title="Zhao Tianlei, Tang Yuxing, Fu Guitao, et al.Accelerating program behavior analysis with dynamic binary translation[J].Journal of Computer Research and Development, 2012, 49 (1) :35-43 (in Chinese) (赵天磊, 唐遇星, 付桂涛, 等.利用动态二进制翻译加速应用程序行为特征分析[J].计算机研究与发展, 2012, 49 (1) :35-43) " target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JFYZ201201005&amp;v=MzEzNjNVUkxPZVplUnFGQ25oVjd2SUx5dlNkTEc0SDlQTXJvOUZZWVFLREg4NHZSNFQ2ajU0TzN6cXFCdEdGckM=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[4]</b>
                                        Zhao Tianlei, Tang Yuxing, Fu Guitao, et al.Accelerating program behavior analysis with dynamic binary translation[J].Journal of Computer Research and Development, 2012, 49 (1) :35-43 (in Chinese) (赵天磊, 唐遇星, 付桂涛, 等.利用动态二进制翻译加速应用程序行为特征分析[J].计算机研究与发展, 2012, 49 (1) :35-43) 
                                    </a>
                                </li>
                                <li id="198">


                                    <a id="bibliography_5" title="Chen Jingsong, Lan Xuhui, Wei Zhong.Software transplant based on instruction simulation[J].Electronic Instrumentation Customer, 2010 (1) :55-57" target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=DZYQ201002026&amp;v=MDE4ODY0VDZqNTRPM3pxcUJ0R0ZyQ1VSTE9lWmVScUZDbmhWN3ZJSVRmU2Y3RzRIOUhNclk5SFlvUUtESDg0dlI=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[5]</b>
                                        Chen Jingsong, Lan Xuhui, Wei Zhong.Software transplant based on instruction simulation[J].Electronic Instrumentation Customer, 2010 (1) :55-57
                                    </a>
                                </li>
                                <li id="200">


                                    <a id="bibliography_6" title="Wegman M N, Zadeck F K.Constant propagation with conditional branches[J].ACM Transactions on Programming Languages and Systems, 1991, 13 (2) :181-210" target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=SJCM&amp;filename=SJCM13091000102579&amp;v=MTEzMzV3WmVadUh5am1VTHZMSVZvUWJoST1OaWZJWTdLN0h0ak5yNDlGWmVzTkNYc3dvQk1UNlQ0UFFIL2lyUmRHZXJxUVRNbg==&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[6]</b>
                                        Wegman M N, Zadeck F K.Constant propagation with conditional branches[J].ACM Transactions on Programming Languages and Systems, 1991, 13 (2) :181-210
                                    </a>
                                </li>
                                <li id="202">


                                    <a id="bibliography_7" title="Muth R.Register liveness analysis of executable code[C/OL].1998[2017-08-05].http://robert.muth.org/Papers/unpub-liveness.pdf" target="_blank"
                                       href="http://scholar.cnki.net/result.aspx?q=Register liveness analysis of executable code[C/OL]">
                                        <b>[7]</b>
                                        Muth R.Register liveness analysis of executable code[C/OL].1998[2017-08-05].http://robert.muth.org/Papers/unpub-liveness.pdf
                                    </a>
                                </li>
                                <li id="204">


                                    <a id="bibliography_8" title="Ma Xiangning, Wu Chenggang, Tang Feng, et al.Two condition code optimization approaches in binary translation[J].Journal of Computer Research and Development, 2005, 42 (2) :329-337 (in Chinese) (马湘宁, 武成岗, 唐锋, 等.二进制翻译中的标志位优化技术[J].计算机研究与发展, 2005, 42 (2) :329-337) " target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JFYZ200502021&amp;v=MjU4NzBUTXJZOUhaWVFLREg4NHZSNFQ2ajU0TzN6cXFCdEdGckNVUkxPZVplUnFGQ25oVjd2SUx5dlNkTEc0SHQ=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[8]</b>
                                        Ma Xiangning, Wu Chenggang, Tang Feng, et al.Two condition code optimization approaches in binary translation[J].Journal of Computer Research and Development, 2005, 42 (2) :329-337 (in Chinese) (马湘宁, 武成岗, 唐锋, 等.二进制翻译中的标志位优化技术[J].计算机研究与发展, 2005, 42 (2) :329-337) 
                                    </a>
                                </li>
                                <li id="206">


                                    <a id="bibliography_9" title="Liang Alei, Guan Haibing, Li Zengxing.A research on register mapping strategies of QEMU[C]//Proc of the 2nd Int Symp on Intelligence Computation and Application.Berlin:Springer, 2007:168-172" target="_blank"
                                       href="http://scholar.cnki.net/result.aspx?q=A research on register mapping strategies of QEMU">
                                        <b>[9]</b>
                                        Liang Alei, Guan Haibing, Li Zengxing.A research on register mapping strategies of QEMU[C]//Proc of the 2nd Int Symp on Intelligence Computation and Application.Berlin:Springer, 2007:168-172
                                    </a>
                                </li>
                                <li id="208">


                                    <a id="bibliography_10" title="Wu Hao.Optimization technology of QEMU[D].Shanghai:Shanghai Jiao Tong University, 2007 (in Chinese) (吴浩.二进制翻译系统QEMU中的优化技术[D].上海:上海交通大学, 2007) " target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=CMFD&amp;filename=2007052402.nh&amp;v=MjYyMTFxRkNuaFY3dklWMTI3R2JPOUhOWE1yWkViUElRS0RIODR2UjRUNmo1NE8zenFxQnRHRnJDVVJMT2VaZVI=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[10]</b>
                                        Wu Hao.Optimization technology of QEMU[D].Shanghai:Shanghai Jiao Tong University, 2007 (in Chinese) (吴浩.二进制翻译系统QEMU中的优化技术[D].上海:上海交通大学, 2007) 
                                    </a>
                                </li>
                                <li id="210">


                                    <a id="bibliography_11" >
                                        <b>[11]</b>
                                    Wen Yanhua, Tang Daguo, Qi Fengbin.Register mapping and register function cutting out implementation in binary translation[J].Journal of Software, 2009, 20 (2) :1-7 (in Chinese) (文延华, 唐大国, 漆锋滨.二进制翻译中的寄存器映射与剪裁的实现[J].软件学报, 2009, 20 (2) :1-7) </a>
                                </li>
                                <li id="212">


                                    <a id="bibliography_12" title="Liao Yin, Sun Guangzhong, Jiang Haitao, et al.All registers direct mapping method in dynamic binary translation[J].Computer Applications and Software, 2011, 28 (11) :21-24 (in Chinese) (廖银, 孙广中, 姜海涛, 等.动态二进制翻译中全寄存器直接映射方法[J].计算机应用与软件, 2011, 28 (11) :21-24) " target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JYRJ201111008&amp;v=MTQ1NTdCdEdGckNVUkxPZVplUnFGQ25oVjd2SUx6VFpaTEc0SDlETnJvOUZiSVFLREg4NHZSNFQ2ajU0TzN6cXE=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[12]</b>
                                        Liao Yin, Sun Guangzhong, Jiang Haitao, et al.All registers direct mapping method in dynamic binary translation[J].Computer Applications and Software, 2011, 28 (11) :21-24 (in Chinese) (廖银, 孙广中, 姜海涛, 等.动态二进制翻译中全寄存器直接映射方法[J].计算机应用与软件, 2011, 28 (11) :21-24) 
                                    </a>
                                </li>
                                <li id="214">


                                    <a id="bibliography_13" title="Cai Zhanju, Liang Alei, Qi Zhengwei, et al.Performance comparison of register allocation algorithms in dynamic binary translation[C]//Proc of the 1st Int Conf on Knowledge and Systems Engineering.Los Alamitos, CA:IEEE Computer Society, 2009:113-119" target="_blank"
                                       href="http://scholar.cnki.net/result.aspx?q=Performance comparison of register allocation algorithms in dynamic binary translation">
                                        <b>[13]</b>
                                        Cai Zhanju, Liang Alei, Qi Zhengwei, et al.Performance comparison of register allocation algorithms in dynamic binary translation[C]//Proc of the 1st Int Conf on Knowledge and Systems Engineering.Los Alamitos, CA:IEEE Computer Society, 2009:113-119
                                    </a>
                                </li>
                                <li id="216">


                                    <a id="bibliography_14" title="Liang Yi, Shao Yuanhua, Yang Guowu, et al.Register allocation for QEMU dynamic binary translation systems[J].International Journal of Hybrid Information Technology, 2015, 8 (2) :199-210" target="_blank"
                                       href="http://scholar.cnki.net/result.aspx?q=Register allocation for QEMU dynamic binary translation systems">
                                        <b>[14]</b>
                                        Liang Yi, Shao Yuanhua, Yang Guowu, et al.Register allocation for QEMU dynamic binary translation systems[J].International Journal of Hybrid Information Technology, 2015, 8 (2) :199-210
                                    </a>
                                </li>
                                <li id="218">


                                    <a id="bibliography_15" title="Bellard F.QEMU, a fast and portable dynamic translator[C]//Proc of the 2nd Conf on USENIX Technical.Berkeley:USENIX Association, 2005:41-41" target="_blank"
                                       href="http://scholar.cnki.net/result.aspx?q=QEMU, a fast and portable dynamic translator">
                                        <b>[15]</b>
                                        Bellard F.QEMU, a fast and portable dynamic translator[C]//Proc of the 2nd Conf on USENIX Technical.Berkeley:USENIX Association, 2005:41-41
                                    </a>
                                </li>
                                <li id="220">


                                    <a id="bibliography_16" title="Jiang Jun, Wang Chao, Wei Hongmei.An optimization strategy for local register allocation[J].Computer Applications and Software, 2013, 30 (12) :215-217 (in Chinese) (姜军, 王超, 尉红梅.一种局部寄存器分配的优化策略[J].计算机应用与软件, 2013, 30 (12) :215-217) " target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JYRJ201312057&amp;v=MjkxMDc0SDlMTnJZOUFZNFFLREg4NHZSNFQ2ajU0TzN6cXFCdEdGckNVUkxPZVplUnFGQ25oVjd2SUx6VFpaTEc=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[16]</b>
                                        Jiang Jun, Wang Chao, Wei Hongmei.An optimization strategy for local register allocation[J].Computer Applications and Software, 2013, 30 (12) :215-217 (in Chinese) (姜军, 王超, 尉红梅.一种局部寄存器分配的优化策略[J].计算机应用与软件, 2013, 30 (12) :215-217) 
                                    </a>
                                </li>
                                <li id="222">


                                    <a id="bibliography_17" title="Hong Dingyong, Hsu Chunchen, Yew Penchung, et al.HQEMU:A multi-threaded and retargetable dynamic binary translator on multicores[C]//Proc of the 10th Int Symp on Code Generation and Optimization.New York:ACM, 2012:104-113" target="_blank"
                                       href="http://scholar.cnki.net/result.aspx?q=HQemu:A multi-threaded and retargetable dynamic binary translator on multicores">
                                        <b>[17]</b>
                                        Hong Dingyong, Hsu Chunchen, Yew Penchung, et al.HQEMU:A multi-threaded and retargetable dynamic binary translator on multicores[C]//Proc of the 10th Int Symp on Code Generation and Optimization.New York:ACM, 2012:104-113
                                    </a>
                                </li>
                                <li id="224">


                                    <a id="bibliography_18" title="Zhang Xichao, Guo Xiangying, Zhao Lei.Study on TCGdynamic binary translation technique[J].Computer Application and Software, 2013, 30 (11) :34-37 (in Chinese) (张西超, 郭向英, 赵雷, 等.TCG动态二进制翻译技术研究[J].计算机应用于研究, 2013, 30 (11) :34-37) " target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JYRJ201311011&amp;v=MjMzNzh0R0ZyQ1VSTE9lWmVScUZDbmhWN3ZJTHpUWlpMRzRIOUxOcm85RVpZUUtESDg0dlI0VDZqNTRPM3pxcUI=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[18]</b>
                                        Zhang Xichao, Guo Xiangying, Zhao Lei.Study on TCGdynamic binary translation technique[J].Computer Application and Software, 2013, 30 (11) :34-37 (in Chinese) (张西超, 郭向英, 赵雷, 等.TCG动态二进制翻译技术研究[J].计算机应用于研究, 2013, 30 (11) :34-37) 
                                    </a>
                                </li>
                                <li id="226">


                                    <a id="bibliography_19" title="Dai Tao, Shan Zheng, Lu Shuaibing, et al.Register allocation algorithm of dynamic binary translation based on priority[J].Journal of Zhejiang University, 2016, 50 (7) , 1338-1346 (in Chinese) (戴涛, 单征, 卢帅兵, 等.基于优先级动态二进制翻译寄存器分配算法[J].浙江大学学报, 2016, 50 (7) :1338-1346) " target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=ZDZC201607016&amp;v=MTMxMTlHRnJDVVJMT2VaZVJxRkNuaFY3dklQeW5SYmJHNEg5Zk1xSTlFWW9RS0RIODR2UjRUNmo1NE8zenFxQnQ=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[19]</b>
                                        Dai Tao, Shan Zheng, Lu Shuaibing, et al.Register allocation algorithm of dynamic binary translation based on priority[J].Journal of Zhejiang University, 2016, 50 (7) , 1338-1346 (in Chinese) (戴涛, 单征, 卢帅兵, 等.基于优先级动态二进制翻译寄存器分配算法[J].浙江大学学报, 2016, 50 (7) :1338-1346) 
                                    </a>
                                </li>
                            </ul>
                            <div style='display: none;' class="zqscroller" >
                                <h4 class="">附加材料</h4>
                                <ul></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            &nbsp;
            <!--此处有一空格符 勿删-->
        </div>

        
    <div class="content">



        <!--tips start-->
                            <div class="tips">
                    <a href="http://navi.cnki.net/KNavi/JournalDetail?pcode=CJFD&amp;pykm=JFYZ" target="_blank">计算机研究与发展</a>
                2019,56(04),708-718 DOI:10.7544/issn1000-1239.2019.20170905            </div>
        <!--tips end-->
            <div class="top-title">
                <h1 class="title">
                    <span class="vm"><b>二进制翻译中动静结合的寄存器分配优化方法</b></span>
                                    </h1>

            </div>
                        <h2>
                                <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=au&amp;skey=%E7%8E%8B%E5%86%9B&amp;code=39976037&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">王军</a>
                                <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=au&amp;skey=%E5%BA%9E%E5%BB%BA%E6%B0%91&amp;code=39547374&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">庞建民</a>
                                <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=au&amp;skey=%E5%82%85%E7%AB%8B%E5%9B%BD&amp;code=39936564&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">傅立国</a>
                                <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=au&amp;skey=%E5%B2%B3%E5%B3%B0&amp;code=41491891&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">岳峰</a>
                                <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=au&amp;skey=%E5%8D%95%E5%BE%81&amp;code=39547373&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">单征</a>
                                <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=au&amp;skey=%E5%BC%A0%E5%AE%B6%E8%B1%AA&amp;code=41491892&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">张家豪</a>
                </h2>
                    <h2>
                    <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=in&amp;skey=%E6%95%B0%E5%AD%A6%E5%B7%A5%E7%A8%8B%E4%B8%8E%E5%85%88%E8%BF%9B%E8%AE%A1%E7%AE%97%E5%9B%BD%E5%AE%B6%E9%87%8D%E7%82%B9%E5%AE%9E%E9%AA%8C%E5%AE%A4(%E6%88%98%E7%95%A5%E6%94%AF%E6%8F%B4%E9%83%A8%E9%98%9F%E4%BF%A1%E6%81%AF%E5%B7%A5%E7%A8%8B%E5%A4%A7%E5%AD%A6)&amp;code=1702647&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">数学工程与先进计算国家重点实验室(战略支援部队信息工程大学)</a>
            </h2>

        
<div class="link">
    <a id="aexport" class="icon icon-output"  onclick="" href="javascript:void(0);"><i></i>导出/参考文献</a>
    
    <span class="shareBoard" onmouseover="$('#sharedet').show();$('#this').addClass('shareBoardCUR')" onmouseout="$('#sharedet').hide();$('#this').removeClass('shareBoardCUR')">
        <a class="icon icon-share" href="#"><i></i>分享<em></em></a>
        <ul class="shareHide" id="sharedet" style="display: none;">
            <li><a title="复制链接" class="copy" onclick="" href="#"><i></i>复制链接</a></li>
            <li><a title="分享到新浪微博" class="xl" onclick="" href="javascript:common.ShareAction('xl');"><i></i>新浪微博</a></li>
            <li>
                <a title="分享到微信" class="wx" onclick="" href="#"><i></i>微信扫一扫</a>
                <div class="qrcode"><img src='' alt='' /></div>
            </li>
        </ul>

    </span>
    
    <a id="RefTrack" title="创建引文跟踪" class="icon icon-track" onclick="" href="javascript:void(0);"> <i></i>创建引文跟踪 </a>
    <a id="ashoucang" title="收藏" class="icon icon-favor" onclick="" href="javascript:void(0);"><i></i>收藏</a>
    <a class="icon icon-print" onclick="window.print();" href="javascript:void(0);"><i></i>打印</a>
    
    <!--版本切换 end-->
</div>
                            <div class="data" id="a_abstract">
                <span class="keys">摘<span style="font-family: 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;</span>要：</span>
                <p>针对二进制翻译器QEMU (quick emulator) 在寄存器映射时未考虑基本块之间以及循环体之间对寄存器需求的差异, 造成不必要的寄存器溢出而导致的冗余访存开销问题, 引入全局寄存器静态映射和局部寄存器动态分配思想, 提出高效的基于优先级的动静结合寄存器映射优化算法.该算法首先基于源平台不同寄存器使用的统计特征和各变量的生命周期, 静态进行全局寄存器映射;然后依据中间表示与源平台寄存器之间的映射关系, 获取基本块中间指令需求寄存器次数并排序确定寄存器分配的优先级;之后依据优先级顺序动态进行寄存器分配, 从而减少寄存器溢出次数, 降低生成的本地代码的膨胀率以及访存次数, 提高目标程序性能.对NBENCH、典型的递归程序和SPEC2006的测试表明:该算法有效地减少了本地代码的访存次数, 提高了程序性能, 平均比优化前性能分别提升了8.67%, 8.25%, 8.10%.</p>
            </div>
                    <div class="data" id="a_keywords">
                <span class="keys">关键词：</span>
                <p>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%BF%BB%E8%AF%91&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">二进制翻译;</a>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=%E5%AF%84%E5%AD%98%E5%99%A8%E5%88%86%E9%85%8D&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">寄存器分配;</a>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=%E7%BF%BB%E8%AF%91%E5%99%A8QEMU&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">翻译器QEMU;</a>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=%E5%8F%8D%E9%A6%88%E5%BC%8F%E9%9D%99%E6%80%81%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%BF%BB%E8%AF%91%E5%99%A8FD-SQEMU&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">反馈式静态二进制翻译器FD-SQEMU;</a>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=TCG%E4%B8%AD%E9%97%B4%E8%A1%A8%E7%A4%BA&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">TCG中间表示;</a>
                </p>
            </div>
        
        <!--brief start-->
        
            <div class="brief">
                    <p>
                            <b>作者简介：</b>
                                                        <span>
                                    *庞建民 (jianmin_pang@126.com) ;
                                </span>
                                <span>
                                    王军, wj_xd@foxmail.com;
                                </span>
                    </p>
                                    <p><b>收稿日期：</b>2017-11-28</p>

                    <p>

                            <b>基金：</b>
                                                        <span>国家自然科学基金项目 (61472447, 61802433);</span>
                    </p>
            </div>
                    <h1><b>A Dynamic and Static Combined Register Mapping Method in Binary Translation</b></h1>
                    <h2>
                    <span>Wang Jun</span>
                    <span>Pang Jianmin</span>
                    <span>Fu Liguo</span>
                    <span>Yue Feng</span>
                    <span>Shan Zheng</span>
                    <span>Zhang Jiahao</span>
            </h2>
                    <h2>
                    <span>State Key Laboratory of Mathematical Engineering and Advanced Computing (Strategic Support Force Information Engineering University)</span>
            </h2>
                            <div class="data" id="a_abstractEN">
                <span class="keys">Abstract：</span>
                <p>To reduce the redundant memory access caused by unnecessary registers overflow in binary translation, as the registers mapping in binary translation ignores the difference of register requirements among basic blocks and loop blocks, an efficient dynamic and static combined registers mapping optimization algorithm based on priority is proposed, introduces the idea of allocating global register statically and allocating local register dynamically. Firstly, global register is mapped statically to reduce the global register overflow cost and maintenance overhead, according to statistical features of different registers used on the source platform and the life cycle of variable. Then, the number of registers requested by intermediate instruction can be obtained, based on the intermediate representation. Therefore, the priority of registers allocation is determined. Lastly, dynamically allocate the registers in order to reduce the number of registers overflow, to reduce the expansion rate of the generated local code and memory access times. Thus, the performance of the target program is improved. The test results of NBENCH, representative recursive programs and SPEC2006 show that, the algorithm effectively reduces the memory access of local code, and improves the program performance with an average increase of 8.56%, 8.14%, and 8.01%, respectively.</p>
            </div>
                    <div class="data" id="a_keywordsEN">
                <span class="keys">Keyword：</span>
                <p>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=binary%20translation&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">binary translation;</a>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=register%20allocation&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">register allocation;</a>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=quick%20emulator%20(QEMU)%20&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">quick emulator (QEMU) ;</a>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=feedback%20static%20QEMU%20(FD-SQEMU)%20&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">feedback static QEMU (FD-SQEMU) ;</a>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=TCG%20intermediate%20code&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">TCG intermediate code;</a>
                </p>
            </div>
                    <div class="brief">
                
                    <p>
                            <b>Author：</b>
                                                        <span>
                                    Wang Jun, born in 1992.PhD candidate. His  main  research  interests  include computer archi-tecture and high perfor-mance computing.<image id="250" type="" href="images/JFYZ201904003_25000.jpg" display="inline" placement="inline"><alt></alt></image>;
                                </span>
                                <span>
                                    Pang Jianmin, born in 1964. PhD, professor, PhD supervisor.Senior member of CCF. His main research interests include computer architecture, information security and high performance computing.<image id="252" type="" href="images/JFYZ201904003_25200.jpg" display="inline" placement="inline"><alt></alt></image>;
                                </span>
                                <span>
                                    Fu Liguo, born in 1989.PhD.His main research interests include advanced compi-lation and high performance computing.<image id="254" type="" href="images/JFYZ201904003_25400.jpg" display="inline" placement="inline"><alt></alt></image>;
                                </span>
                                <span>
                                    Yue Feng, born in 1985.PhD.Member of CCF.His main research interests include advanced compilation and high perfor-mance computing.<image id="256" type="" href="images/JFYZ201904003_25600.jpg" display="inline" placement="inline"><alt></alt></image>;
                                </span>
                                <span>
                                    Shan Zheng, born in 1964.PhD, professor, PhD supervisor.Senior member of CCF. His main research interests include computer architecture, information security and high performance calculation.<image id="258" type="" href="images/JFYZ201904003_25800.jpg" display="inline" placement="inline"><alt></alt></image>;
                                </span>
                                <span>
                                    Zhang Jiahao, born in 1991.Master.His main research interests include computer architecture and high performance computing.<image id="260" type="" href="images/JFYZ201904003_26000.jpg" display="inline" placement="inline"><alt></alt></image>;
                                </span>
                    </p>
                                    <p><b>Received：</b> 2017-11-28</p>
                                    <p>
                            <b>Fund：</b>
                                                        <span>supported by the National Natural Science Foundation of China (61472447, 61802433);</span>
                    </p>
            </div>


        <!--brief start-->
                        <div class="p1">
                    <p id="47">二进制翻译<citation id="228" type="reference"><link href="190" rel="bibliography" /><sup>[<a class="sup">1</a>]</sup></citation>是一种即时编译技术, 其核心目标是将一种体系结构的指令序列转换成功能等价的另一种可执行指令序列, 已广泛用于软件安全分析<citation id="234" type="reference"><link href="192" rel="bibliography" /><link href="194" rel="bibliography" /><sup>[<a class="sup">2</a>,<a class="sup">3</a>]</sup></citation>、程序行为分析<citation id="229" type="reference"><link href="196" rel="bibliography" /><sup>[<a class="sup">4</a>]</sup></citation>、软件逆向工程、系统虚拟等领域, 并已成为软件移植<citation id="230" type="reference"><link href="198" rel="bibliography" /><sup>[<a class="sup">5</a>]</sup></citation>的主流技术之一.二进制翻译的过程可分为前端解码、中间优化以及后端编码3个部分.前端解码的主要工作类似于反汇编, 依据源指令的特点分离出每条机器指令, 将二进制可执行程序翻译成中间代码;中端优化的主要工作是优化生成的中间代码, 通过分析中间代码组织关系简化中间代码, 常用的冗余代码消除方法有常量传播<citation id="231" type="reference"><link href="200" rel="bibliography" /><sup>[<a class="sup">6</a>]</sup></citation>、变量活性分析<citation id="232" type="reference"><link href="202" rel="bibliography" /><sup>[<a class="sup">7</a>]</sup></citation>和标志位优化等<citation id="233" type="reference"><link href="204" rel="bibliography" /><sup>[<a class="sup">8</a>]</sup></citation>;后端编码的主要工作是本地目标代码的生成, 将优化后的中间代码转换生成本地可执行的代码序列, 其中包含寄存器分配过程.</p>
                </div>
                <div class="p1">
                    <p id="48">寄存器分配无论是在高性能应用程序编译, 还是在高性能程序翻译, 又或者在充分利用高性能处理器的目标上, 都有着重要的研究意义, 好的寄存器分配方式可以有效提高程序执行效率.寄存器分配的目的是尽可能地将程序中的值保存在寄存器中, 从而最大限度地减少访存次数, 提高程序的执行效率, 寄存器分配优化的重点在如何处理寄存器溢出问题.</p>
                </div>
                <div class="p1">
                    <p id="49">不同于传统编译器中的寄存器分配, 二进制翻译中寄存器分配的实质更像是寄存器映射, 需要重点考虑源平台寄存器使用情况.目前常用的寄存器分配方法主要是寄存器图着色法、线性扫描法以及基于这2种方法的优化变种.二进制翻译, 尤其是动态二进制翻译最常采用基于线性扫描的寄存器分配方法.</p>
                </div>
                <div class="p1">
                    <p id="50">目前, 已有较多人针对二进制翻译中的寄存器分配进行了研究.Liang等人<citation id="235" type="reference"><link href="206" rel="bibliography" /><sup>[<a class="sup">9</a>]</sup></citation>对动态二进制翻译器QEMU (quick emulator) 中寄存器的管理及分配机制进行了详细的描述, 但并未给出一种有效的改进方法;吴浩<citation id="236" type="reference"><link href="208" rel="bibliography" /><sup>[<a class="sup">10</a>]</sup></citation>通过对比实验说明了中间表示降低了二进制翻译的性能, 并在x86平台翻译ARM程序时采用寄存器直接映射策略提高了翻译效率, 但是该方法需要大幅度地修改QEMU的翻译机制且通用性不强.文延华等人<citation id="237" type="reference"><link href="210" rel="bibliography" /><sup>[<a class="sup">11</a>]</sup></citation>在Alpha平台翻译PowerPC程序时, 对PowerPC中的特殊寄存器采用二进制翻译模拟、提出分段映射和特殊寄存器裁剪相结合的方法获得了一定的优化效果, 但寄存器裁剪函数较为复杂且可被优化的程序较少;廖银等人<citation id="238" type="reference"><link href="212" rel="bibliography" /><sup>[<a class="sup">12</a>]</sup></citation>在MIPS平台模拟x86平台寄存器时采用直接映射策略, 利用本地平台通用寄存器数量多的特点, 直接将x86的8个通用寄存器一一映射到MIPS的通用寄存器上, 简化了指令翻译的规则, 降低了代码膨胀率, 但该方法依赖于特定的硬件基础, 通用性和可移植性不够强;Cai等人<citation id="239" type="reference"><link href="214" rel="bibliography" /><sup>[<a class="sup">13</a>]</sup></citation>在cross-bit系统中提出了简化的寄存器图着色法, 使用3个链表收集变量定值引用信息, 将活跃变量构造成一个图, 之后遇到寄存器溢出情况则重新构造冲突图, 但冲突图的构造大大增加了翻译的开销, 整体的效率提升有限;Liang等人<citation id="240" type="reference"><link href="216" rel="bibliography" /><sup>[<a class="sup">14</a>]</sup></citation>基于QEMU的中间表示, 分析变量的定值与引用, 使用链表存储变量的生命周期和使用情况, 减少了中间表示指令数目, 但由于需要多次遍历采集基本块内变量的定值与引用信息, 算法的复杂度较高且不具有良好的移植性.</p>
                </div>
                <div class="p1">
                    <p id="51">本文结合QEMU<citation id="241" type="reference"><link href="218" rel="bibliography" /><sup>[<a class="sup">15</a>]</sup></citation>的翻译原理、QEMU使用的中间表示TCG (tiny code generation) 中临时变量与寄存器分配之间的关系以及QEMU的寄存器分配机制<citation id="242" type="reference"><link href="206" rel="bibliography" /><sup>[<a class="sup">9</a>]</sup></citation>, 引入全局寄存器静态映射和局部寄存器动态分配思想<citation id="243" type="reference"><link href="220" rel="bibliography" /><sup>[<a class="sup">16</a>]</sup></citation>, 提出了基于优先级的动静结合二进制翻译寄存器分配优化算法.首先, 根据x86平台应用程序各寄存器使用情况的整体统计数据进行全局寄存器静态映射;然后依据基本块内中间表示每条指令需求的寄存器数量及寄存器分配次数, 排序确定各寄存器在基本块内分配的优先级顺序, 动态分配寄存器;最后溢出循环块内未使用的全局寄存器供局部变量使用, 并将全局寄存器的维护放在循环之外, 尽可能减少因寄存器溢出而导致的冗余访存指令, 尤其是循环体内的冗余访存指令, 提高程序的执行效率.</p>
                </div>
                <h3 id="52" name="52" class="anchor-tag"><b>1 相关工作</b></h3>
                <div class="p1">
                    <p id="53">QEMU是一个广泛使用的支持用户级和系统级翻译的多源到多目标的动态二进制翻译系统<citation id="244" type="reference"><link href="218" rel="bibliography" /><sup>[<a class="sup">15</a>]</sup></citation>.QEMU的动态翻译过程如图1所示, 其中寄存器分配工作在QEMU翻译后端进行.</p>
                </div>
                <div class="area_img" id="54">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JFYZ201904003_054.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图1 QEMU翻译过程" src="Detail/GetImg?filename=images/JFYZ201904003_054.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图1 QEMU翻译过程  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JFYZ201904003_054.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit">Fig. 1 QEMU translation process</p>

                </div>
                <div class="p1">
                    <p id="55">为了实现多源到多目标的翻译, QEMU中采用了机器无关的中间表示TCG.基于TCG, 不同源平台只需要变换前端解码器而不需要改动后端编码器, 即可实现多源到目标平台的翻译, 具有很好的跨平台特性.QEMU动态翻译的基本原理是利用指令变换时的语义等价, 将源体系架构程序的指令翻译成一条或者多条TCG中间表示, 然后将TCG中间表示变换成目标平台的一条或者多条指令, 保证上述两者转换过程中指令语义的一致, 实现不同平台上指令的等价.</p>
                </div>
                <div class="p1">
                    <p id="56">本文提出的基于优先级的二进制翻译寄存器分配优化算法, 主要是针对课题组基于QEMU研发的反馈式静态二进制翻译器FD-SQEMU (feedback static QEMU) 设计的, 但是该算法具有很好的跨平台特性和扩展性, 稍加改动即可在动态二进制翻译中使用.</p>
                </div>
                <h4 class="anchor-tag" id="57" name="57"><b>1.1 基于QEMU的反馈式静态翻译器FD-SQEMU</b></h4>
                <div class="p1">
                    <p id="58">课题组基于QEMU, 采用了QEMU的前端分析和TCG中间表示, 设计了反馈式静态二进制翻译框架FD-SQEMU, 该静态翻译器继承了QEMU跨平台的特性.FD-SQEMU除了前端源指令提取、TCG中端分析优化和后端目标代码生成3个过程外, 还添加了动态执行反馈阶段, 用以解决静态二进制翻译中存在的代码发现和代码定位问题.FD-SQEMU的框架结构如图2所示:</p>
                </div>
                <div class="area_img" id="59">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JFYZ201904003_059.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图2 FD-SQEMU框架设计" src="Detail/GetImg?filename=images/JFYZ201904003_059.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图2 FD-SQEMU框架设计  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JFYZ201904003_059.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit">Fig. 2 Framework of FD-SQEMU</p>

                </div>
                <div class="p1">
                    <p id="60">FD-SQEMU前端的源文件解析器和前端解码器以及中端TCG分析优化器均采用QEMU的相应模块, 删除了QEMU中控制中心、缓存管理和执行模块, 后端则添加了目标文件生成器, 重点是引入了动态执行反馈模块实现静态二进制翻译中代码发现和代码定位.</p>
                </div>
                <div class="p1">
                    <p id="61">源文件解析器、前端解码器和新添加的预处理模块构成FD-SQEMU的前端, 负责将源平台二进制代码 (本文即x86代码) 翻译成中间代码TCG;</p>
                </div>
                <div class="p1">
                    <p id="62">TCG分析优化器构成FD-SQEMU的中端, 负责对TCG中间表示进行平台无关优化, 包括TCG的优化, 同时对源程序变量信息进行统计;</p>
                </div>
                <div class="p1">
                    <p id="63">后端翻译器和目标文件生成器, 构成FD-SQEMU的后端, 负责将TCG中间代码翻译成目标平台的二进制代码 (本文为申威架构的代码) ;</p>
                </div>
                <div class="p1">
                    <p id="64">动态执行反馈模块主要是模拟执行, 用以获取反馈静态无法得到的间接跳转和间接调用目标地址, 辅助解决静态二进制翻译中代码发现和代码定位问题.</p>
                </div>
                <div class="p1">
                    <p id="65">与QEMU和基于LLVM的动态二进制翻译器<citation id="245" type="reference"><link href="222" rel="bibliography" /><sup>[<a class="sup">17</a>]</sup></citation>相比, FD-SQEMU分离翻译、代码优化与目标程序执行阶段, 使得在同等优化手段下, FD-SQEMU能够采用不同层次的优化算法, 生成高质量的执行代码.本文提出的寄存器优化方法在中端TCG分析优化器内进行相关信息分析, 在后端代码生成阶段进行实际实现.</p>
                </div>
                <h4 class="anchor-tag" id="66" name="66"><b>1.2 TCG指令</b></h4>
                <div class="p1">
                    <p id="67">TCG指令类似于一种RISC (reduced instruction set computer) 的指令, 同样拥有数据传送、算术运算、逻辑运算、程序控制指令及其他指令<citation id="246" type="reference"><link href="224" rel="bibliography" /><sup>[<a class="sup">18</a>]</sup></citation>.QEMU在tcg/tcg-opc.h中对所有TCG指令进行了定义, TCG指令格式定义为DEF (<i>name</i>, <i>oargs</i>, <i>iargs</i>, <i>cargs</i>, <i>flags</i>) , 其中<i>name</i>为微指令的名字, <i>oargs</i>为指令输出参数个数, <i>iargs</i>为指令输入参数个数, <i>cargs</i>为指令常数个数, <i>flags</i>标志指令是否影响内存内容.此外, 该结构体中还有参数<i>args</i>_<i>ct</i>与<i>sorted</i>, 该参数与具体体系结构的寄存器紧密相关.</p>
                </div>
                <div class="p1">
                    <p id="68">TCG指令的操作数称为临时变量, 构成TCG中间表示的基础, 是源机器指令操作数到目标机器指令数传递、存储与计算的桥梁.根据临时变量生命周期的不同划分, TCG定义了普通变量 (<i>temp</i>) 、普通本地变量 (<i>localtemp</i>) 、全局变量 (<i>globaltemp</i>) 和全局寄存器变量 (<i>globalregtemp</i>) 四种临时变量类型.TCG变量统一用结构体<i>TCGTemp</i>进行描述, 变量类型通过结构体<i>TCGTemp</i>中的标志位进行区分.</p>
                </div>
                <div class="p1">
                    <p id="69">全局变量和全局寄存器变量生命周期贯穿程序的整个翻译过程, 分配的地址只有程序退出时才被收回.全局寄存器变量一般固定分配宿主机某一个寄存器值, 用来保存源机器<i>CPUState</i>结构体的指针, 实现源机器状态数据的快速读取, 加快程序执行速度;普通变量生命周期范围为一个基本块, 基本块执行结束变量被标注为“释放”状态, 备下一个指令块使用.普通本地变量的生命周期为一个函数, 与普通变量不同的是在某些基本块末尾处需要保存执行时的数据流信息以供函数内另一个基本块使用, 即需要将基本块的执行信息进行回写.</p>
                </div>
                <div class="p1">
                    <p id="70">临时变量内容均存储在TCG上下文的512个<i>TCGTemp</i>的静态数组<i>static</i>_<i>temps</i>中.其中全局变量和全局寄存器变量采取一次性分配策略建立运行时环境, 在以后翻译的过程中不会再进行分配, 生命周期贯穿程序始终.全局变量源机器平台运行环境<i>env</i>一般用全局寄存器变量表示, 源机器平台如标志寄存器用全局内存变量表示, 存储分布在静态数组<i>static</i>_<i>temps</i>的起始处;普通变量和普通本地变量依据源机器指令进行动态分配, 存储在数组后面部分, 每分配出一个, 则将该空间打上标记进行标识.临时变量的存储空间分布如图3所示:</p>
                </div>
                <div class="area_img" id="71">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JFYZ201904003_071.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图3 临时变量内存布局" src="Detail/GetImg?filename=images/JFYZ201904003_071.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图3 临时变量内存布局  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JFYZ201904003_071.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit">Fig. 3 Temporary variable memory format</p>

                </div>
                <h3 id="72" name="72" class="anchor-tag"><b>2 QEMU中TCG寄存器分配机制研究</b></h3>
                <div class="p1">
                    <p id="73">寄存器作为CPU体系最重要的信息存储部件, 它的读写速度远远快于存储器, 它的利用效率直接影响程序的执行速度;在二进制翻译中, 寄存器分配的好坏同样对目标程序的执行效率有着重要影响.</p>
                </div>
                <div class="p1">
                    <p id="74">如引言所述, 二进制翻译的过程是将源体系的可执行代码翻译成中间代码再翻译成本地可执行代码的过程;从寄存器映射的角度看, 二进制翻译是从源体系的寄存器直接映射到虚拟机维护的一套内存虚拟寄存器, 再由虚拟寄存器映射到目标体系上的寄存器的过程, 临时变量是上述寄存器转换的“传输者”.</p>
                </div>
                <h4 class="anchor-tag" id="75" name="75"><b>2.1 QEMU中TCG寄存器分配机制</b></h4>
                <div class="p1">
                    <p id="76">QEMU中寄存器分配的主体包括2个部分<citation id="247" type="reference"><link href="226" rel="bibliography" /><sup>[<a class="sup">19</a>]</sup></citation>:1) 内存虚拟寄存器;2) 中间代码使用的临时变量.一套虚拟寄存器是一片连续的内存区域, 内存虚拟寄存器主要是TCG中间表示源自于源体系寄存器的一一映射, 以x86代码为例, 如图4所示.对于内存虚拟寄存器, QEMU采用静态直接映射方法, 使用固定的寄存器绑定方式实现源体系寄存器到本地寄存器的映射.如x86的宿主机用ebp寄存器指向<i>env</i>, 利用ebp寄存器偏移即可获取整个虚拟寄存器, 实现源体系寄存器到本地寄存器的映射.</p>
                </div>
                <div class="area_img" id="77">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JFYZ201904003_077.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图4 源体系寄存器到TCG虚拟寄存器的映射" src="Detail/GetImg?filename=images/JFYZ201904003_077.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图4 源体系寄存器到TCG虚拟寄存器的映射  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JFYZ201904003_077.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit">Fig. 4 Mapping from source register to TCG virtual  register</p>

                </div>
                <div class="p1">
                    <p id="78">TCG中间代码使用的临时变量类似于传统编译器中的虚拟寄存器, 对于翻译程序而言, 相对于通用寄存器不存在差异性, 但其到本地目标寄存器的映射要复杂得多.</p>
                </div>
                <div class="p1">
                    <p id="79">对于QEMU中间代码使用的临时变量, 其寄存器分配采用线性扫描静态固定分配机制 (first-mean-busy, FMB) , 即“最靠前者最忙碌”, 通过线性扫描目标体系提供的寄存器数组索引进行本地寄存器的分配.分配的具体实现过程为:1) 当中间变量需要进行本地寄存器分配时, 依据中间指令操作码和中间变量位置, 确定临时变量可分配寄存器范围.2) 从数组的起点开始遍历, 当遇到某寄存器处于“空闲状态”时, 即分配该寄存器, 并将该寄存器的状态置为“忙碌”, 中止遍历, 待对应中间变量使用结束后即释放该寄存器;若遍历完的寄存器数组索引都处于“忙碌”的状态, 则采用线性遍历寄存器数组从数组中强制“溢出”一个寄存器作为指定分配的寄存器, 因溢出的寄存器保存着上一个临时变量的值, 在释放寄存器的同时需将“溢出”的寄存器中的值写回内存中, 以保证寄存器中的值不丢失.</p>
                </div>
                <h4 class="anchor-tag" id="80" name="80"><b>2.2 TCG寄存器分配机制的缺陷</b></h4>
                <div class="p1">
                    <p id="81">根据2.1节对TCG寄存器分配机制的分析, TCG指令内变量的寄存器分配采用优先级的方法, 利用操作数可分配寄存器个数划分优先级, 避免了寄存器分配竞争时导致操作数分配不到寄存器资源;指令间的寄存器分配方法采取简单的线性扫描和溢出, 缺少指令间寄存器分配的优化算法, 若发生资源竞争, 则进行现行的寄存器溢出处理, 显然存在不合理之处, 以申威宿主机翻译x86可执行程序为例, 如图5所示:</p>
                </div>
                <div class="area_img" id="82">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JFYZ201904003_082.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图5 TCG中间表示与翻译后的本地代码" src="Detail/GetImg?filename=images/JFYZ201904003_082.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图5 TCG中间表示与翻译后的本地代码  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JFYZ201904003_082.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit">Fig. 5 TCG intermediate representation and local instruction after translation</p>

                </div>
                <div class="p1">
                    <p id="83">图5中左边为TCG中间代码 (为观察方便, 在TCG中间表示中添加了对应的x86汇编码) ;右边为翻译后生成的申威本地指令, 每条中间指令对应生成相应的申威本地指令.其中<i>x</i>指令部分将$9寄存器分配给了<i>tmp</i>0, <i>y</i>指令部分也给<i>tmp</i>0分配$9寄存器时, <i>z</i>指令部分分别将$9和$10寄存器分配给<i>tmp</i>0和<i>tmp</i>1.在这里, QEMU实际上没有考虑指令间寄存器的使用情况, 鉴于可能存在的寄存器溢出情况, 在每条指令寄存器使用完毕后, 都做了回写处理, 引入了冗余访存指令①②③④, 这是因为QEMU在进行寄存器分配时忽略了指令间的联系, 引入了冗余指令, 另外若下一指令或者指令块要继续使用rdx和rax中值, 则⑤⑥⑦访存指令也是冗余且可以消除的.</p>
                </div>
                <div class="area_img" id="84">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JFYZ201904003_084.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图6 有关循环的寄存器分配例子" src="Detail/GetImg?filename=images/JFYZ201904003_084.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图6 有关循环的寄存器分配例子  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JFYZ201904003_084.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit">Fig. 6 Example of registers allocation for loops</p>

                </div>
                <div class="p1">
                    <p id="85">另外, QEMU中TCG寄存器分配机制也没考虑到程序上下文对寄存器分配的影响, 忽略了循环体内寄存器分配对程序整体效率的影响, 以图6为例进行说明.</p>
                </div>
                <div class="p1">
                    <p id="86">如图6 (a) 所示, 基本块或者几个基本块拼接成的循环块CB1位于循环体内, 假设执行频率<i>N</i>=1 000, 当对CB1循环块进行寄存器分配时, 若发现寄存器不够用, 则很可能会溢出一个寄存器, 假设是<i>A</i>, 那么循环块的头尾会各添加一个访存指令如图6 (b) 所示, 如此store和load指令都在循环体内部, 显然会降低程序性能, 如果在寄存器分配前进行评估, 优先满足循环体内部的寄存器需求, 如此<i>A</i>可能因为无法分配到寄存器而溢出, 如图6 (c) 所示, 这样成功把访存指令移到了循环之外, 有效提高了翻译后本地程序的性能.</p>
                </div>
                <div class="p1">
                    <p id="87">针对上述由于寄存器溢出而导致的冗余访存问题, 本文结合全局寄存器静态分配和局部寄存器动态分配思想, 提出基于优先级的动静结合寄存器分配算法 (a dynamic and static combined registers allocation algorithm based on priority) .首先依据程序的静态统计特征, 实现静态全局寄存器的直接映射, 以减少全局寄存器的维护开销;然后借助程序的控制流程图, 结合变量活性分析基本块内指令操作数寄存器分配个数, 减少指令间寄存器以及循环体内不必要的寄存器溢出, 以减少本地代码的膨胀率, 提高翻译目标程序的执行效率.</p>
                </div>
                <h3 id="88" name="88" class="anchor-tag"><b>3 基于优先级的动静结合寄存器分配算法</b></h3>
                <div class="p1">
                    <p id="89">目前QEMU中使用的TCG寄存器分配机制的主要缺陷在于仅解决了指令内操作数分配的竞争, 让指令内操作数分配到最优的寄存器, 而对指令间寄存器采用固定的分配顺序, 忽略了基本块内指令组成以及对寄存器需求的差异性, 指令间固定的寄存器分配顺序与指令内的寄存器最优分配并没有实现整个基本块以及整个程序中寄存器分配的最优.</p>
                </div>
                <div class="p1">
                    <p id="90">寄存器分配效率提高的关键在于如何最大限度减少寄存器溢出带来的开销.基于此, 考虑到将目标程序中最常用的寄存器固定映射到本地机器的寄存器, 可以有效避免过多的访存操作, 提高翻译后的程序性能.因此, 对x86应用程序和部分系统程序中寄存器使用情况进行统计对于寄存器的分配是有指导意义的.以系统Linux-0.2启动过程为例, x86上各寄存器使用情况统计结果如表1所示:</p>
                </div>
                <div class="area_img" id="91">
                    <p class="img_tit"><b>表1 x86程序寄存器使用情况统计</b> <a class="downexcel" onclick="DownLoadReportExcel(this)">导出到EXCEL</a></p>
                    <p class="img_tit"><b>Table 1 Register Usage Statistics on x86 Program</b></p>
                    <p class="img_note"></p>
                    <table id="91" border="1"><tr><td><br />x86<br />Registers</td><td>Percentage of<br />Use Frequency<br />/%</td><td>x86<br />Registers</td><td>Percentage of<br />Use Frequency<br />/%</td></tr><tr><td><br />eax</td><td>29.6</td><td>esp</td><td>16.0</td></tr><tr><td><br />ebx</td><td>12.6</td><td>ebp</td><td>4.8</td></tr><tr><td><br />ecx</td><td>8.1</td><td>edi</td><td>6.5</td></tr><tr><td><br />edx</td><td>13.3</td><td>esi</td><td>9.1</td></tr></table>
                    <form name="form" action="/kxreader/Detail/DownloadReportExcel" method="POST" style="display:inline">
                        <input type="hidden" name="hidTable" value="" />
                        <input type="hidden" name="hidFileName" value="" />
                    </form>
                    <p class="img_note"></p>
                    <p class="img_note"></p>
                </div>
                <div class="p1">
                    <p id="92">表1给出了系统Linux-0.2在启动时x86平台各寄存器的使用情况, 从表1中可以看出x86架构运行时最常使用的寄存器是eax, ebx, edx, esp.x86应用程序寄存器的使用情况与此相似.</p>
                </div>
                <div class="p1">
                    <p id="93">基于x86平台各寄存器使用情况的统计特征, 在翻译程序具体进行寄存器分配时, 首先根据x86寄存器使用情况, 采用寄存器直接映射方式进行全局寄存器静态分配.如在翻译中具体进行寄存器分配时, 可首先将x86上eax, ebx, edx, esp寄存器映射到申威处理器通用寄存器$9, $10, $11, $12上;然后当翻译x86指令时, 即可直接使用对应的已固定映射到本地的通用寄存器替换x86中eax, ebx, edx, esp寄存器, 而无需再从内存模拟的虚拟寄存器中加载, 可以有效减少访存操作, 提高程序运行效率.</p>
                </div>
                <div class="p1">
                    <p id="94">在全局寄存器静态直接映射分配的基础上, 再根据翻译程序基本块的特性进行局部的动态寄存器分配.具体做法是:首先通过变量活性分析遍历基本块内有效的中间指令, 预估统计指令内操作数需求寄存器数;然后依据预估的寄存器数排序确定寄存器分配优先顺序.若可分配的寄存器预估需求数目越大, 则基本块内指令对该寄存器的需求就越大, 分配该寄存器的优先级越高, 优先分配该寄存器, 依次进行, 优先级最低的寄存器最慢分配出去.如此, 剩余指令对寄存器需求的可能性变小, 从而最大限度地减少寄存器溢出的可能性并使寄存器溢出的代价减少.具体的算法流程图如图7所示:</p>
                </div>
                <div class="area_img" id="95">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JFYZ201904003_095.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图7 算法流程图" src="Detail/GetImg?filename=images/JFYZ201904003_095.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图7 算法流程图  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JFYZ201904003_095.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit">Fig. 7 Algorithm flowchart</p>

                </div>
                <div class="p1">
                    <p id="96">1) TCG作为FD-SQEMU前端代码解析和后端目标代码生成的纽带, 记录了基本块内全局变量个数和基本块跳转等信息.在此基础上, 添加基本块内寄存器需求数组<i>regRequestNum</i>和寄存器优先级数组<i>regPriority</i>, 分别记录基本块内需求寄存器的局部变量个数 (即寄存器需求数) 和基本块内各寄存器分配的次序 (即需求该寄存器的优先程度) .在翻译每个基本块之初, 对这2个数组进行初始化.</p>
                </div>
                <div class="p1">
                    <p id="97">2) 借助变量活性分析线性扫描基本块内TCG指令, 统计寄存器需求数目.这里对已固定分配寄存器的全局变量不作变量处理, 但进行块内使用标记;对于其他变量, 只须将对应各TCG指令内需求寄存器的计数器<i>regRequestNum</i>采取迭代累加的方法, 即可完成寄存器分配计数器的统计, 该迭代累加算法的伪代码如图8所示:</p>
                </div>
                <div class="area_img" id="127">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JFYZ201904003_12700.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图8 部分算法伪代码" src="Detail/GetImg?filename=images/JFYZ201904003_12700.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图8 部分算法伪代码  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JFYZ201904003_12700.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit">Fig. 8 Pseudo-code algorithm</p>

                </div>
                <div class="p1">
                    <p id="128">3) 对寄存器需求数组<i>regRequestNum</i>进行降序排序, 变量排序越靠前说明基本块内对该寄存器的需求就越大, 反之则越小, 优先对靠前的变量进行寄存器分配, 可有效降低基本块内寄存器溢出的开销.如该数值为0, 则说明该变量已分配固定的全局寄存器或者不需要分配寄存器.</p>
                </div>
                <div class="p1">
                    <p id="129">4) 依据控制流程图判断该基本块是否是循环体内的基本块, 若是且该循环块内仍有多次使用的变量未分配到寄存器, 则将该循环体内未使用的全局寄存器溢出, 供该循环块内变量使用;并依据循环优化中代码外提方法将该全局寄存器的状态维护代码外提到循环体外.如此, 可进一步提高目标平台寄存器的利用率, 减少寄存器溢出开销, 提高程序运行效率.</p>
                </div>
                <h3 id="130" name="130" class="anchor-tag"><b>4 实验和结果</b></h3>
                <div class="p1">
                    <p id="131">实验采用由QEMU改造的FD-SQEMU模拟器作为二进制翻译平台, 首先借助FD-SQEMU翻译器使用QEMU中默认的寄存器分配方法对测试用例进行翻译;然后借助FD-SQEMU翻译器在进行寄存器分配优化后对测试用例进行翻译, 对比两次翻译后得到的目标程序的运行时间, 以评估基于优先级的动静结合寄存器分配优化算法的实际优化效果.</p>
                </div>
                <div class="p1">
                    <p id="132">令<i>T</i><sub>before</sub>和<i>T</i><sub>after</sub>分别表示在使用寄存器分配优化算法前和使用寄存器分配优化算法后的本地目标程序的执行时间, 则使用寄存器分配优化后与优化前的加速比为</p>
                </div>
                <div class="p1">
                    <p id="133" class="code-formula">
                        <mathml id="133"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>S</mi><mi>p</mi><mi>e</mi><mi>e</mi><mi>d</mi><mi>u</mi><mi>p</mi><mo>=</mo><mfrac><mrow><mn>1</mn><mo>/</mo><mi>Τ</mi><msub><mrow></mrow><mrow><mtext>a</mtext><mtext>f</mtext><mtext>t</mtext><mtext>e</mtext><mtext>r</mtext></mrow></msub></mrow><mrow><mn>1</mn><mo>/</mo><mi>Τ</mi><msub><mrow></mrow><mrow><mtext>b</mtext><mtext>e</mtext><mtext>f</mtext><mtext>o</mtext><mtext>r</mtext><mtext>e</mtext></mrow></msub></mrow></mfrac><mo>-</mo><mn>1</mn><mo>=</mo><mfrac><mrow><mi>Τ</mi><msub><mrow></mrow><mrow><mtext>b</mtext><mtext>e</mtext><mtext>f</mtext><mtext>o</mtext><mtext>r</mtext><mtext>e</mtext></mrow></msub><mo>-</mo><mi>Τ</mi><msub><mrow></mrow><mrow><mtext>a</mtext><mtext>f</mtext><mtext>t</mtext><mtext>e</mtext><mtext>r</mtext></mrow></msub></mrow><mrow><mi>Τ</mi><msub><mrow></mrow><mrow><mtext>a</mtext><mtext>f</mtext><mtext>t</mtext><mtext>e</mtext><mtext>r</mtext></mrow></msub></mrow></mfrac><mo>.</mo></mrow></math></mathml>
                    </p>
                </div>
                <div class="p1">
                    <p id="134">在实际进行测试验证时, 实验通过正确性测试、循环热代码测试、递归热代码测试和整体性能测试对提出的算法进行整体评估.</p>
                </div>
                <h4 class="anchor-tag" id="135" name="135"><b>4.1 实验环境</b></h4>
                <div class="p1">
                    <p id="136">1) 源平台.x86平台, 操作系统为Fedora11 Linux 2.6.29.4 编译器gcc-4.6.4.</p>
                </div>
                <div class="p1">
                    <p id="137">2) 目标平台.国产申威处理器, 主频1.4 GHz, 内存4 GB, 操作系统为Fedora, 内核版本3.8.0, 编译器为 gcc, 版本 4.5.3.</p>
                </div>
                <div class="p1">
                    <p id="138">3) 测试集.NBENCH-2.2.3, 手动实现的主流递归算法和SPEC2006测试集<citation id="248" type="reference"><link href="226" rel="bibliography" /><sup>[<a class="sup">19</a>]</sup></citation>.</p>
                </div>
                <h4 class="anchor-tag" id="139" name="139"><b>4.2 正确性测试</b></h4>
                <div class="p1">
                    <p id="140">针对寄存器优化算法的正确性测试主要分为2个部分:指令翻译测试和实际程序翻译测试.</p>
                </div>
                <div class="p1">
                    <p id="141">指令翻译测试借助FD-SQEMU自带的test-i386测试集, 重点对x86架构用户态的指令进行了测试.依据x86指令分类情况, 具体的测试结果如表2所示.</p>
                </div>
                <div class="p1">
                    <p id="142">在保证了单条指令翻译的正确性后, 对实际程序翻译进行了正确性测试.具体测试过程为:1) 在x86平台上编译SPEC CPU2006和NBENCH测试集等测试程序并运行记录结果;2) 在目标平台上运行翻译后的可执行程序, 并与x86上运行结果相比对.部分程序的测试结果如表3所示.</p>
                </div>
                <div class="p1">
                    <p id="143">实验结果表明, 优化前后的目标程序执行结果与源x86平台上程序执行结果相同, 表明基于优先级的动静结合寄存器分配算法能够进行正确的翻译, 保证了程序的等价翻译, 具有较高的可信度.</p>
                </div>
                <div class="area_img" id="144">
                    <p class="img_tit"><b>表2 指令翻译的正确性测试</b> <a class="downexcel" onclick="DownLoadReportExcel(this)">导出到EXCEL</a></p>
                    <p class="img_tit"><b>Table 2 Correctness Testing of Instruction Translation</b></p>
                    <p class="img_note"></p>
                    <table id="144" border="1"><tr><td><br />Test Instruction</td><td>Test Result</td></tr><tr><td><br />Data Movement Instructions</td><td>√</td></tr><tr><td><br />Destination Address Transfer Instruction</td><td>√</td></tr><tr><td><br />Arithmetic Instruction</td><td>√</td></tr><tr><td><br />Logical Instruction</td><td>√</td></tr><tr><td><br />String Instructions</td><td>√</td></tr><tr><td><br />Program Transfer Instructions</td><td>√</td></tr><tr><td><br />Shift and Bit Instructions</td><td>√</td></tr></table>
                    <form name="form" action="/kxreader/Detail/DownloadReportExcel" method="POST" style="display:inline">
                        <input type="hidden" name="hidTable" value="" />
                        <input type="hidden" name="hidFileName" value="" />
                    </form>
                    <p class="img_note"></p>
                    <p class="img_note">Note:“√” mean that the test instructions have passed the correctness verification.</p>
                </div>
                <div class="area_img" id="145">
                    <p class="img_tit"><b>表3 正确性测试</b> <a class="downexcel" onclick="DownLoadReportExcel(this)">导出到EXCEL</a></p>
                    <p class="img_tit"><b>Table 3 Correct Test</b></p>
                    <p class="img_note"></p>
                    <table id="145" border="1"><tr><td><br />Test Case</td><td>Before Optimization</td><td>After Optimization</td></tr><tr><td><br />NUMERIC_SORT</td><td>√</td><td>√</td></tr><tr><td><br />STRING_SORT</td><td>√</td><td>√</td></tr><tr><td><br />BITFIELD</td><td>√</td><td>√</td></tr><tr><td><br />FP EMULATION</td><td>√</td><td>√</td></tr><tr><td><br />FOURIER</td><td>√</td><td>√</td></tr><tr><td><br />IDEA</td><td>√</td><td>√</td></tr><tr><td><br />HUFFMAN</td><td>√</td><td>√</td></tr><tr><td><br />NUEURAL NET</td><td>√</td><td>√</td></tr><tr><td><br />LU DECOMPOSITION</td><td>√</td><td>√</td></tr><tr><td><br />FIBONACCI</td><td>√</td><td>√</td></tr><tr><td><br />QUICKSORT</td><td>√</td><td>√</td></tr><tr><td><br />MERGESORT</td><td>√</td><td>√</td></tr><tr><td><br />N-QUEEN</td><td>√</td><td>√</td></tr><tr><td><br />BZIP2</td><td>√</td><td>√</td></tr><tr><td><br />MILC</td><td>√</td><td>√</td></tr><tr><td><br />SPECRAND</td><td>√</td><td>√</td></tr><tr><td><br />MCF</td><td>√</td><td>√</td></tr></table>
                    <form name="form" action="/kxreader/Detail/DownloadReportExcel" method="POST" style="display:inline">
                        <input type="hidden" name="hidTable" value="" />
                        <input type="hidden" name="hidFileName" value="" />
                    </form>
                    <p class="img_note"></p>
                    <p class="img_note">Note:“√” mean that the test cases have passed the correctness verification.</p>
                </div>
                <h4 class="anchor-tag" id="146" name="146"><b>4.3 寄存器分配相关信息分析</b></h4>
                <div class="p1">
                    <p id="147">申威处理器共计有6个全局寄存器S0～S5、12个临时寄存器T0～T11.使用QEMU现有的寄存器分配机制进行二进制翻译时, 大量使用了S0, S1, S2寄存器, 并在每次全局寄存器使用完毕后将其中的值写回存储器, 一是对其余现有的寄存器利用率较低, 二是引入了不必要的寄存器维护开销;在改进寄存器分配方式后, 各基本块对申威寄存器的使用更加均衡, 能有效减少因寄存器溢出导致的访存次数.寄存器分配方式改进前, 各申威本地寄存器使用频率如表4所示:</p>
                </div>
                <div class="area_img" id="148">
                    <p class="img_tit"><b>表4 优化前部分申威本地寄存器使用频率</b> <a class="downexcel" onclick="DownLoadReportExcel(this)">导出到EXCEL</a></p>
                    <p class="img_tit"><b>Table 4 Registers Usage Frequency of SW Before Optimization</b></p>
                    <p class="img_note"></p>
                    <table id="148" border="1"><tr><td><br />SW<br />Registers</td><td>Percentage of <br />Use Frequency<br />/%</td><td>SW<br />Registers</td><td>Percentage of <br />Use Frequency<br />/%</td></tr><tr><td><br />S0</td><td>33.2</td><td>T1</td><td>1.9</td></tr><tr><td><br />S1</td><td>30.9</td><td>T2</td><td>0.7</td></tr><tr><td><br />S2</td><td>25.6</td><td>T3</td><td>0.2</td></tr><tr><td><br />S3</td><td>6.3</td><td>T4</td><td>0.1</td></tr><tr><td><br />S4</td><td>0.9</td><td>T5</td><td>0</td></tr><tr><td><br />S5</td><td>0.2</td><td>T6</td><td>0</td></tr></table>
                    <form name="form" action="/kxreader/Detail/DownloadReportExcel" method="POST" style="display:inline">
                        <input type="hidden" name="hidTable" value="" />
                        <input type="hidden" name="hidFileName" value="" />
                    </form>
                    <p class="img_note"></p>
                    <p class="img_note"></p>
                </div>
                <div class="p1">
                    <p id="149">改进寄存器分配方式后, 各申威本地寄存器使用频率所占百分比如表5所示:</p>
                </div>
                <div class="area_img" id="150">
                    <p class="img_tit"><b>表5 优化后部分申威本地寄存器使用频率</b> <a class="downexcel" onclick="DownLoadReportExcel(this)">导出到EXCEL</a></p>
                    <p class="img_tit"><b>Table 5 Register Usage Frequency of SW After Optimization</b></p>
                    <p class="img_note"></p>
                    <table id="150" border="1"><tr><td><br />SW<br />Registers</td><td>Percentage of <br />Use Frequency<br />/%</td><td>SW<br />Registers</td><td>Percentage of <br />Use Frequency<br />/%</td></tr><tr><td>S0</td><td>13.5</td><td>T1</td><td>20.2</td></tr><tr><td><br />S1</td><td>12.3</td><td>T2</td><td>18.9</td></tr><tr><td><br />S2</td><td>6.3</td><td>T3</td><td>15.4</td></tr><tr><td><br />S3</td><td>0.8</td><td>T4</td><td>8.6</td></tr><tr><td><br />S4</td><td>0.2</td><td>T5</td><td>3.2</td></tr><tr><td><br />S5</td><td>0.1</td><td>T6</td><td>0.5</td></tr></table>
                    <form name="form" action="/kxreader/Detail/DownloadReportExcel" method="POST" style="display:inline">
                        <input type="hidden" name="hidTable" value="" />
                        <input type="hidden" name="hidFileName" value="" />
                    </form>
                    <p class="img_note"></p>
                    <p class="img_note"></p>
                </div>
                <div class="p1">
                    <p id="151">如表5所示, 该寄存器分配方式, 有效地提高了本地临时寄存器的使用率, 并且使申威寄存器的使用更加均衡, 可以减少寄存器的溢出次数.在寄存器分配优化后, 翻译后程序的指令平均减少了约2.3%.</p>
                </div>
                <h4 class="anchor-tag" id="152" name="152"><b>4.4 循环热代码性能测试</b></h4>
                <div class="p1">
                    <p id="153">NBENCH测试集的主要功能是通过计算一定时间内 (一般是5 s) 单项测试代码块的循环迭代次数来评价系统性能, 其中每一个测试块都是典型的循环热代码, 具体的NBENCH测试集各部分功能如表6所示.</p>
                </div>
                <div class="p1">
                    <p id="154">使用寄存器分配优化前和优化后的FD-SQEMU在国产申威处理器上对NBENCH测试集进行对比测试, 优化后相对于优化前的加速情况如图9所示.</p>
                </div>
                <div class="p1">
                    <p id="155">如图9所示, 对于不同的NBENCH测试项目, 寄存器分配优化后获得的加速比也不同.</p>
                </div>
                <div class="area_img" id="156">
                    <p class="img_tit"><b>表6 NBENCH测试任务</b> <a class="downexcel" onclick="DownLoadReportExcel(this)">导出到EXCEL</a></p>
                    <p class="img_tit"><b>Table 6 NBENCH Tasks</b></p>
                    <p class="img_note"></p>
                    <table id="156" border="1"><tr><td><br />Test Case</td><td>Tasks</td></tr><tr><td><br />NUMERIC_SORT</td><td>Sort an array of long integers</td></tr><tr><td><br />STRING_SORT</td><td>Sort an array of strings of arbitrary length</td></tr><tr><td><br />BITFIELD</td><td>Execute a variety of bit manipulation functions</td></tr><tr><td><br />FP EMULATION</td><td>A small software floating-point package</td></tr><tr><td><br />FOURIER</td><td>A numerical analysis routine for calculating series approximations of waveforms</td></tr><tr><td><br />ASSIGNMENT</td><td>A well-known task allocation algorithm</td></tr><tr><td><br />IDEA</td><td>A text and graphics compression algorithm</td></tr><tr><td><br />HUFFMAN</td><td>A relatively new block cipher algorithm</td></tr><tr><td><br />NUEURAL NET</td><td>A small but functional back-propagation network simulator</td></tr><tr><td><br />LU DECOMPOSITION</td><td>A robust algorithm for solving linear equations</td></tr></table>
                    <form name="form" action="/kxreader/Detail/DownloadReportExcel" method="POST" style="display:inline">
                        <input type="hidden" name="hidTable" value="" />
                        <input type="hidden" name="hidFileName" value="" />
                    </form>
                    <p class="img_note"></p>
                    <p class="img_note"></p>
                </div>
                <div class="area_img" id="157">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JFYZ201904003_157.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图9 优化后NBENCH加速情况" src="Detail/GetImg?filename=images/JFYZ201904003_157.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图9 优化后NBENCH加速情况  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JFYZ201904003_157.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit">Fig. 9 Speedup ratio on NBENCH after optimization</p>

                </div>
                <h4 class="anchor-tag" id="158" name="158"><b>4.5 递归热代码性能测试</b></h4>
                <div class="p1">
                    <p id="159">递归算法是会反复执行的热代码, 在实际程序中递归代码也是大量存在的, 递归程序中对单一或某些函数的反复调用会产生大量的函数调用和返回指令, 此时全局寄存器的分配和溢出处理也直接影响着程序执行效率.本文对典型的递归算法进行了测试, 测试结果如图10所示:</p>
                </div>
                <div class="area_img" id="160">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JFYZ201904003_160.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图10 优化后递归热代码加速情况" src="Detail/GetImg?filename=images/JFYZ201904003_160.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图10 优化后递归热代码加速情况  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JFYZ201904003_160.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit">Fig. 10 Speedup ratio on recursive algorithms after  optimization</p>

                </div>
                <h4 class="anchor-tag" id="161" name="161"><b>4.6 整体性能测试</b></h4>
                <div class="p1">
                    <p id="162">SPEC2006测试集中的程序基本都是实际应用中常用到的程序, 该测试集的执行结果能够反映出一个翻译系统的整体性能.在具体实验时, 挑选了部分SPEC2006中常用的测试应用进行测试, 采用FD-SQEMU在寄存器分配优化后翻译源程序为本地目标程序, 该程序性能提升情况如图11所示:</p>
                </div>
                <div class="area_img" id="163">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JFYZ201904003_163.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图11 优化后部分SPEC2006测试项的加速情况" src="Detail/GetImg?filename=images/JFYZ201904003_163.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图11 优化后部分SPEC2006测试项的加速情况  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JFYZ201904003_163.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit">Fig. 11 Speed up ratio on part of SPEC2006 after  optimization</p>

                </div>
                <h4 class="anchor-tag" id="164" name="164"><b>4.7 实验结果分析</b></h4>
                <div class="p1">
                    <p id="165">通过对不同程序进行测试, 根据图9～11中结果可以看出改进了寄存器分配方式后, 各程序都有不错的性能提升, 其中NBENCH测试集中STRING_SORT和BITFIELD的测试程序性能提升最高, 最高达到了17.36%.改进寄存器分配方式后, 根据图9中测试结果NBENCH各测试项性能提升4.35%～17.24%, 平均性能提升约为8.56%;根据图10中测试结果, FIBONACCI, QUICKSORT等递归程序性能提升7.86%～8.54%, 平均性能提升了8.14%;根据图11, SPEC2006程序性能提升了6.94%～9.62%, 平均性能提升了8.01%.根据测试结果, 说明该寄存器分配优化算法是有效的, 且对于含循环、递归较多的程序, 有更好的优化效果.</p>
                </div>
                <h3 id="166" name="166" class="anchor-tag"><b>5 总 结</b></h3>
                <div class="p1">
                    <p id="167">本文在分析QEMU的寄存器分配方法后, 举例指出了该机制存在的缺陷, 并在介绍了由QEMU改造的静态二进制翻译器FD-SQEMU后, 借鉴传统编译器静态全局寄存器分配和动态局部寄存器分配思想后, 提出了基于优先级的动静结合寄存器分配方法.该算法, 首先依据x86应用程序统计特征进行全局寄存器静态直接映射分配;然后考虑各循环块以及基本块间寄存器需求的差异, 利用TCG中间表示操作码与本地指令之间的映射关系统计基本块内需求的各寄存器次数, 并排序确定优先级顺序进行寄存器分配;最后, 溢出循环块内未使用的全局寄存器, 给块内未分配到寄存器的变量使用, 进一步减少了寄存器溢出的开销.通过NBENCH、某些经典递归程序和部分SPEC2006程序对该算法进行测试, 结果表明该寄存器分配优化算法能有效提高目标程序的执行效率.另外, 该算法对具体的目标平台依赖不大, 具有很好的跨平台特性, 另外, 舍去该算法中依据程序控制流程图对循环块的处理亦可适用于动态二进制翻译.</p>
                </div>
                <div class="p1">
                    <p id="168">寄存器分配的研究无论是对于传统编译器, 还是对于二进制翻译, 从更好地发挥CPU的性能以及提高高性能计算程序的执行效率方面都有重要的意义.</p>
                </div>

        <!--brief end-->
        
        <!--conten left  end-->
        <!--增强附件-->
        

        <!--reference start-->
            <div class="reference anchor-tag" id="a_bibliography">
                    <h3>参考文献</h3>
                                        <p id="190">
                            <a id="bibliography_1" target="_blank" href="http://scholar.cnki.net/result.aspx?q=Welcome to the opportunities of binary translation">

                                <b>[1]</b>Altman E R, Kaeli D, Sheffer Y.Welcome to the opportunities of binary translation[J].Computer, 2000, 33 (3) :40-45
                            </a>
                        </p>
                        <p id="192">
                            <a id="bibliography_2" target="_blank" href="http://scholar.cnki.net/result.aspx?q=BTMD:Aframework of binary translation based malcode detector">

                                <b>[2]</b>Shan Zheng, Guo Haoran, Pang Jianmin.BTMD:Aframework of binary translation based malcode detector[C]//Proc of the 4th Int Conf on Cyber-Enabled Distributed Computing and Knowledge Discovery.Los Alamitos, CA:IEEE Computer Society, 2012:39-43
                            </a>
                        </p>
                        <p id="194">
                            <a id="bibliography_3" target="_blank" href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JFYZ201311022&amp;v=MTQ3MzVxcUJ0R0ZyQ1VSTE9lWmVScUZDbmhWN3ZJTHl2U2RMRzRIOUxOcm85SFpvUUtESDg0dlI0VDZqNTRPM3o=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[3]</b>Ma Jinxin, Li Zhoujun, Hu Chaojian, et al.A reconstruction method of type abstraction in binary code[J].Journal of Computer Research and Development, 2013, 50 (11) :2418-2428 (in Chinese) (马金鑫, 李舟军, 忽朝俭, 等.一种重构二进制代码中类型抽象的方法[J].计算机研究与发展, 2013, 50 (11) :2418-2428) 
                            </a>
                        </p>
                        <p id="196">
                            <a id="bibliography_4" target="_blank" href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JFYZ201201005&amp;v=MjIyODFIODR2UjRUNmo1NE8zenFxQnRHRnJDVVJMT2VaZVJxRkNuaFY3dklMeXZTZExHNEg5UE1ybzlGWVlRS0Q=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[4]</b>Zhao Tianlei, Tang Yuxing, Fu Guitao, et al.Accelerating program behavior analysis with dynamic binary translation[J].Journal of Computer Research and Development, 2012, 49 (1) :35-43 (in Chinese) (赵天磊, 唐遇星, 付桂涛, 等.利用动态二进制翻译加速应用程序行为特征分析[J].计算机研究与发展, 2012, 49 (1) :35-43) 
                            </a>
                        </p>
                        <p id="198">
                            <a id="bibliography_5" target="_blank" href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=DZYQ201002026&amp;v=MDc0OTc3dklJVGZTZjdHNEg5SE1yWTlIWW9RS0RIODR2UjRUNmo1NE8zenFxQnRHRnJDVVJMT2VaZVJxRkNuaFY=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[5]</b>Chen Jingsong, Lan Xuhui, Wei Zhong.Software transplant based on instruction simulation[J].Electronic Instrumentation Customer, 2010 (1) :55-57
                            </a>
                        </p>
                        <p id="200">
                            <a id="bibliography_6" target="_blank" href="/kcms/detail/detail.aspx?dbcode=SJCM&amp;filename=SJCM13091000102579&amp;v=MDc4NTZyUmRHZXJxUVRNbndaZVp1SHlqbVVMdkxJVm9RYmhJPU5pZklZN0s3SHRqTnI0OUZaZXNOQ1hzd29CTVQ2VDRQUUgvaQ==&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[6]</b>Wegman M N, Zadeck F K.Constant propagation with conditional branches[J].ACM Transactions on Programming Languages and Systems, 1991, 13 (2) :181-210
                            </a>
                        </p>
                        <p id="202">
                            <a id="bibliography_7" target="_blank" href="http://scholar.cnki.net/result.aspx?q=Register liveness analysis of executable code[C/OL]">

                                <b>[7]</b>Muth R.Register liveness analysis of executable code[C/OL].1998[2017-08-05].http://robert.muth.org/Papers/unpub-liveness.pdf
                            </a>
                        </p>
                        <p id="204">
                            <a id="bibliography_8" target="_blank" href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JFYZ200502021&amp;v=MTk4MzR6cXFCdEdGckNVUkxPZVplUnFGQ25oVjd2SUx5dlNkTEc0SHRUTXJZOUhaWVFLREg4NHZSNFQ2ajU0TzM=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[8]</b>Ma Xiangning, Wu Chenggang, Tang Feng, et al.Two condition code optimization approaches in binary translation[J].Journal of Computer Research and Development, 2005, 42 (2) :329-337 (in Chinese) (马湘宁, 武成岗, 唐锋, 等.二进制翻译中的标志位优化技术[J].计算机研究与发展, 2005, 42 (2) :329-337) 
                            </a>
                        </p>
                        <p id="206">
                            <a id="bibliography_9" target="_blank" href="http://scholar.cnki.net/result.aspx?q=A research on register mapping strategies of QEMU">

                                <b>[9]</b>Liang Alei, Guan Haibing, Li Zengxing.A research on register mapping strategies of QEMU[C]//Proc of the 2nd Int Symp on Intelligence Computation and Application.Berlin:Springer, 2007:168-172
                            </a>
                        </p>
                        <p id="208">
                            <a id="bibliography_10" target="_blank" href="/kcms/detail/detail.aspx?dbcode=CMFD&amp;filename=2007052402.nh&amp;v=MjI5ODZPOUhOWE1yWkViUElRS0RIODR2UjRUNmo1NE8zenFxQnRHRnJDVVJMT2VaZVJxRkNuaFY3dklWMTI3R2I=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[10]</b>Wu Hao.Optimization technology of QEMU[D].Shanghai:Shanghai Jiao Tong University, 2007 (in Chinese) (吴浩.二进制翻译系统QEMU中的优化技术[D].上海:上海交通大学, 2007) 
                            </a>
                        </p>
                        <p id="210">
                            <a id="bibliography_11" >
                                    <b>[11]</b>
                                Wen Yanhua, Tang Daguo, Qi Fengbin.Register mapping and register function cutting out implementation in binary translation[J].Journal of Software, 2009, 20 (2) :1-7 (in Chinese) (文延华, 唐大国, 漆锋滨.二进制翻译中的寄存器映射与剪裁的实现[J].软件学报, 2009, 20 (2) :1-7) 
                            </a>
                        </p>
                        <p id="212">
                            <a id="bibliography_12" target="_blank" href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JYRJ201111008&amp;v=MDU1NjhaZVJxRkNuaFY3dklMelRaWkxHNEg5RE5ybzlGYklRS0RIODR2UjRUNmo1NE8zenFxQnRHRnJDVVJMT2U=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[12]</b>Liao Yin, Sun Guangzhong, Jiang Haitao, et al.All registers direct mapping method in dynamic binary translation[J].Computer Applications and Software, 2011, 28 (11) :21-24 (in Chinese) (廖银, 孙广中, 姜海涛, 等.动态二进制翻译中全寄存器直接映射方法[J].计算机应用与软件, 2011, 28 (11) :21-24) 
                            </a>
                        </p>
                        <p id="214">
                            <a id="bibliography_13" target="_blank" href="http://scholar.cnki.net/result.aspx?q=Performance comparison of register allocation algorithms in dynamic binary translation">

                                <b>[13]</b>Cai Zhanju, Liang Alei, Qi Zhengwei, et al.Performance comparison of register allocation algorithms in dynamic binary translation[C]//Proc of the 1st Int Conf on Knowledge and Systems Engineering.Los Alamitos, CA:IEEE Computer Society, 2009:113-119
                            </a>
                        </p>
                        <p id="216">
                            <a id="bibliography_14" target="_blank" href="http://scholar.cnki.net/result.aspx?q=Register allocation for QEMU dynamic binary translation systems">

                                <b>[14]</b>Liang Yi, Shao Yuanhua, Yang Guowu, et al.Register allocation for QEMU dynamic binary translation systems[J].International Journal of Hybrid Information Technology, 2015, 8 (2) :199-210
                            </a>
                        </p>
                        <p id="218">
                            <a id="bibliography_15" target="_blank" href="http://scholar.cnki.net/result.aspx?q=QEMU, a fast and portable dynamic translator">

                                <b>[15]</b>Bellard F.QEMU, a fast and portable dynamic translator[C]//Proc of the 2nd Conf on USENIX Technical.Berkeley:USENIX Association, 2005:41-41
                            </a>
                        </p>
                        <p id="220">
                            <a id="bibliography_16" target="_blank" href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JYRJ201312057&amp;v=MzIzNDhIOUxOclk5QVk0UUtESDg0dlI0VDZqNTRPM3pxcUJ0R0ZyQ1VSTE9lWmVScUZDbmhWN3ZJTHpUWlpMRzQ=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[16]</b>Jiang Jun, Wang Chao, Wei Hongmei.An optimization strategy for local register allocation[J].Computer Applications and Software, 2013, 30 (12) :215-217 (in Chinese) (姜军, 王超, 尉红梅.一种局部寄存器分配的优化策略[J].计算机应用与软件, 2013, 30 (12) :215-217) 
                            </a>
                        </p>
                        <p id="222">
                            <a id="bibliography_17" target="_blank" href="http://scholar.cnki.net/result.aspx?q=HQemu:A multi-threaded and retargetable dynamic binary translator on multicores">

                                <b>[17]</b>Hong Dingyong, Hsu Chunchen, Yew Penchung, et al.HQEMU:A multi-threaded and retargetable dynamic binary translator on multicores[C]//Proc of the 10th Int Symp on Code Generation and Optimization.New York:ACM, 2012:104-113
                            </a>
                        </p>
                        <p id="224">
                            <a id="bibliography_18" target="_blank" href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JYRJ201311011&amp;v=MjkwNTQ5RVpZUUtESDg0dlI0VDZqNTRPM3pxcUJ0R0ZyQ1VSTE9lWmVScUZDbmhWN3ZJTHpUWlpMRzRIOUxOcm8=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[18]</b>Zhang Xichao, Guo Xiangying, Zhao Lei.Study on TCGdynamic binary translation technique[J].Computer Application and Software, 2013, 30 (11) :34-37 (in Chinese) (张西超, 郭向英, 赵雷, 等.TCG动态二进制翻译技术研究[J].计算机应用于研究, 2013, 30 (11) :34-37) 
                            </a>
                        </p>
                        <p id="226">
                            <a id="bibliography_19" target="_blank" href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=ZDZC201607016&amp;v=MTg5MTZZb1FLREg4NHZSNFQ2ajU0TzN6cXFCdEdGckNVUkxPZVplUnFGQ25oVjd2SVB5blJiYkc0SDlmTXFJOUU=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[19]</b>Dai Tao, Shan Zheng, Lu Shuaibing, et al.Register allocation algorithm of dynamic binary translation based on priority[J].Journal of Zhejiang University, 2016, 50 (7) , 1338-1346 (in Chinese) (戴涛, 单征, 卢帅兵, 等.基于优先级动态二进制翻译寄存器分配算法[J].浙江大学学报, 2016, 50 (7) :1338-1346) 
                            </a>
                        </p>
            </div>
        <!--reference end-->
        <!--footnote start-->
        <!--footnote end-->



    </div>

        <input id="fileid" type="hidden" value="JFYZ201904003" />
        <input id="dpi" type="hidden" value="300" />
    </div>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?6e967eb120601ea41b9d312166416aa6";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


    


<input id="hid_uid" name="hid_uid" type="hidden" value="WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
<input id="hid_kLogin_headerUrl" name="hid_kLogin_headerUrl" type="hidden" value="/KLogin/Request/GetKHeader.ashx%3Fcallback%3D%3F" />
<input id="hid_kLogin_footerUrl" name="hid_kLogin_footerUrl" type="hidden" value="/KLogin/Request/GetKFooter.ashx%3Fcallback%3D%3F" />
<div class="btn-link" style="display: none"><a target="_blank" href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JFYZ201904003&amp;v=MDU1MDNVUkxPZVplUnFGQ25oVjd2SUx5dlNkTEc0SDlqTXE0OUZaNFFLREg4NHZSNFQ2ajU0TzN6cXFCdEdGckM=&amp;uid=WEEvREcwSlJHSldRa1FhdXNXaEhoRFQzZ2tpSTBoVC9vc1JrQ2loSzM0UT0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">知网节</a></div>
<div class="popflow" id="popupTips" style="display: none;">
    <div class="popflowArr"></div>
    <div class="popflowCot">
        <div class="hd"><a href="javascript:void(0);" onclick="$('#popupTips').hide();$('#popupmsg').html('')" class="close">X</a></div>
        <div class="bd">
            <p class="mes" id="popupmsg" name="popupmsg"></p>
          
        </div>
    </div>
</div>
<input type="hidden" id="myexport" value="//kns.cnki.net" />

<input type="hidden" id="KPCAPIPATH" value="//ishufang.cnki.net" />
<input type="hidden" id="CitedTimes" value="" />
<div class="link" id="GLSearch" style="display: none;">
    <i class="icon-trangle"></i>
    <div class="inner">
        <a class="icon" id="copytext">复制</a>
        <a class="icon" target="_blank" onclick="searchCRFD(this)">工具书搜索</a>
    </div>
</div>




<input id="hidVirtualPath" name="hidVirtualPath" type="hidden" value="/kxreader" />
<script src="/kxreader/bundles/detail?v=-ULdk-c6FkZHtJA2KAXPgHnyA8mtgyPnBde_C2VZ2BY1"></script>

<script src="/kxreader/Scripts/layer.min.js" type="text/javascript"></script>

<div id="footerBox" class="rootw footer">
</div>
<script>
    if (typeof FlushLogin == 'function') {
        FlushLogin();
    }
    modifyEcpHeader(true);
</script>

<!--图片放大功能 start-->
<script src="/kxreader/bundles/imagebox?v=W4phPu9SNkGcuPeJclikuVE3PpRyIW_gnfjm_19nynI1"></script>

<script type="text/javascript">
    $(function () {
        var j = $.noConflict();
        j(function () {
            j(".zoom-in,.btn-zoomin").imgbox({
                'alignment': 'center',
                'allowMultiple': false,
                'overlayShow': true
            });
        })
    });
</script>
<!--图片放大功能 end-->
<div class="fixedbar">
    <div class="backtop hiddenV" id="backtop">
        <a id="backTopSide" href="javascript:scroll(0,0);" title=""></a>
    </div>
</div>
<script type="text/javascript" src="/kxreader/Scripts/MathJax-2.6-latest/MathJax.js?config=MML_HTMLorMML-full"></script>


    <link href="/kxreader/Content/css/LeftDetail?v=NLcKG8I1SJUaVFrQ0iGpF2klAT0OsmHRaVSZ1rKb5xg1" rel="stylesheet"/>

</body>
</html>

