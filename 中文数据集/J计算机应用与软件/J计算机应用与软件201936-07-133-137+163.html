<!DOCTYPE html>
<html>
<head>
    <title>全文阅读--XML全文阅读--中国知网</title>
    <link rel="icon" href="/kxreader/favicon.ico" />
    <link rel="shortcut Icon" href="/kxreader/favicon.ico" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="文献 XML KBASE CNKI 中国知网" />
    <meta name="description" content="XML文献检索" />
    <link href="/kxreader/Content/css/detail?v=qX2z2KjRAEyQiNfAbKtl7dLnsqFoQ5Jdw3TZfDf0n1k1" rel="stylesheet"/>

    <script type="text/javascript">
        var APPPATH = '/kxreader';
    </script>
</head>

<body>
    
<script type="text/javascript" src="//login.cnki.net/TopLogin/api/loginapi/get?type=top&amp;localCSS=&amp;returnurl=%2f%2fkns.cnki.net%2f%2fKXReader%2fDetail%3fTIMESTAMP%3d637135623152033750%26DBCODE%3dCJFD%26TABLEName%3dCJFDLAST2019%26FileName%3dJYRJ201907024%26RESULT%3d1%26SIGN%3dupiqFatAnJ0dy%252fTU%252fY97IogI1kI%253d"></script>

<div id="headerBox" class="header">
    <div class="topbar">
        <div class="textalign">
            <a href="/kxreader/Detail?dbcode=CJFD&amp;filename=JYRJ201907024&amp;align=md">
                <i class="icon-cen active" title="居中对齐"></i>
            </a>
            <a href="/kxreader/Detail?dbcode=CJFD&amp;filename=JYRJ201907024&amp;align=lt">
                <i class="icon-left " title="左对齐"></i>
            </a>
        </div>
        <h6 class="free-tip"><i class="icon"></i>HTML阅读开放试用阶段，欢迎体验！</h6>
    </div>
</div>

    



<div class="btn-link" style="display: none"><a target="_blank" href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JYRJ201907024&amp;v=MjkyNjBGckNVUjdxZlp1WnRGeWpnVjcvTUx6VFpaTEc0SDlqTXFJOUhZSVFLREg4NHZSNFQ2ajU0TzN6cXFCdEc=&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">知网节</a></div>

    <div class="main">

        

    <div class="sidebar-a">
        <!--sidebar start-->
        <div class="sidenav">
            <div class="arrow"><span></span></div>
            <!--sidebar_list start-->
            <dl class="sidenav-list">
                    <dt class="tit">目录结构</dt>
                            <dd class="guide">
                                    <p><a href="#21" data-title="&lt;b&gt;0 引 言&lt;/b&gt; "><b>0 引 言</b></a><i></i></p>
                                                            </dd>
                            <dd class="guide">
                                    <p><a href="#26" data-title="&lt;b&gt;1 现状分析&lt;/b&gt; "><b>1 现状分析</b></a><i></i></p>
                                                            </dd>
                            <dd class="guide">
                                    <p><a href="#32" data-title="&lt;b&gt;2 票卡物理介质&lt;/b&gt; "><b>2 票卡物理介质</b></a><i></i></p>
                                                                    <ul class="contentbox">
                                                <li><a href="#34" data-title="&lt;b&gt;2.1 单程票&lt;/b&gt;"><b>2.1 单程票</b></a></li>
                                                <li><a href="#44" data-title="&lt;b&gt;2.2 MIFARE Classic卡&lt;/b&gt;"><b>2.2 MIFARE Classic卡</b></a></li>
                                                <li><a href="#54" data-title="&lt;b&gt;2.3 MIFARE Pro卡&lt;/b&gt;"><b>2.3 MIFARE Pro卡</b></a></li>
                                    </ul>
                            </dd>
                            <dd class="guide">
                                    <p><a href="#64" data-title="&lt;b&gt;3 与票卡的交互流程&lt;/b&gt; "><b>3 与票卡的交互流程</b></a><i></i></p>
                                                                    <ul class="contentbox">
                                                <li><a href="#67" data-title="&lt;b&gt;3.1 寻卡流程&lt;/b&gt;"><b>3.1 寻卡流程</b></a></li>
                                                <li><a href="#71" data-title="&lt;b&gt;3.2 MIFARE Classic操作&lt;/b&gt;"><b>3.2 MIFARE Classic操作</b></a></li>
                                                <li><a href="#78" data-title="&lt;b&gt;3.3 MIFARE Pro卡操作&lt;/b&gt;"><b>3.3 MIFARE Pro卡操作</b></a></li>
                                    </ul>
                            </dd>
                            <dd class="guide">
                                    <p><a href="#83" data-title="&lt;b&gt;4 车票的使用&lt;/b&gt; "><b>4 车票的使用</b></a><i></i></p>
                                                                    <ul class="contentbox">
                                                <li><a href="#85" data-title="&lt;b&gt;4.1 对票卡物理介质的识别&lt;/b&gt;"><b>4.1 对票卡物理介质的识别</b></a></li>
                                                <li><a href="#96" data-title="&lt;b&gt;4.2 对MIFARE Pro卡的识别&lt;/b&gt;"><b>4.2 对MIFARE Pro卡的识别</b></a></li>
                                                <li><a href="#101" data-title="&lt;b&gt;4.3 票卡应用优化法测试&lt;/b&gt;"><b>4.3 票卡应用优化法测试</b></a></li>
                                    </ul>
                            </dd>
                            <dd class="guide">
                                    <p><a href="#108" data-title="&lt;b&gt;5 系统架构&lt;/b&gt; "><b>5 系统架构</b></a><i></i></p>
                                                            </dd>
                            <dd class="guide">
                                    <p><a href="#122" data-title="&lt;b&gt;6 结 语&lt;/b&gt; "><b>6 结 语</b></a><i></i></p>
                                                            </dd>
                            <dd class="guide">
                                    <p><a href="#" data-title="文内图表 ">文内图表</a><i></i></p>
                                                                    <ul class="contentbox">
                                                <li><a href="#43" data-title="图1 MIFARE Ultralight卡存储结构图">图1 MIFARE Ultralight卡存储结构图</a></li>
                                                <li><a href="#53" data-title="图2 MIFARE Classic卡存储结构图">图2 MIFARE Classic卡存储结构图</a></li>
                                                <li><a href="#63" data-title="图3 CPU卡存储结构图">图3 CPU卡存储结构图</a></li>
                                                <li><a href="#69" data-title="图4 非接触式IC卡寻卡流程图">图4 非接触式IC卡寻卡流程图</a></li>
                                                <li><a href="#77" data-title="图5 MIFARE Classic卡操作命令流程图">图5 MIFARE Classic卡操作命令流程图</a></li>
                                                <li><a href="#82" data-title="图6 MIFARE Pro卡操作命令流程图">图6 MIFARE Pro卡操作命令流程图</a></li>
                                                <li><a href="#87" data-title="图7 寻卡 (Request) 命令应答值定义">图7 寻卡 (Request) 命令应答值定义</a></li>
                                                <li><a href="#90" data-title="图8 选择卡 (Select) 命令应答值定义">图8 选择卡 (Select) 命令应答值定义</a></li>
                                                <li><a href="#95" data-title="图9 区分MIFARE Ultralight、MIFARE Classic 和MIFARE Pro流程图">图9 区分MIFARE Ultralight、MIFARE Classic 和MIFARE Pro流......</a></li>
                                                <li><a href="#100" data-title="图10 某城市地铁CPU卡应用流程">图10 某城市地铁CPU卡应用流程</a></li>
                                                <li><a href="#104" data-title="&lt;b&gt;表1 尝试法寻卡时间表&lt;/b&gt;"><b>表1 尝试法寻卡时间表</b></a></li>
                                                <li><a href="#106" data-title="&lt;b&gt;表2 优化后寻卡时间表&lt;/b&gt;"><b>表2 优化后寻卡时间表</b></a></li>
                                                <li><a href="#111" data-title="图11 读写器内软件系统结构示意图">图11 读写器内软件系统结构示意图</a></li>
                                    </ul>
                            </dd>
                                    <dd class="guide">
                                        <h6>
                                            <p><a href="#a_bibliography">参考文献</a> </p>
                                        </h6>
                                    </dd>

            </dl>
        </div>
        <!--sidebar end-->
        &nbsp;
        <!--此处有一空格符 勿删-->
    </div>

                <div class="sidebar-b three-collumn" style="width:0;">
            <div class="refer" style="width: 0;">
                <div class="arrow off" title="参考文献"><span></span></div>
                <div class="js-scrollbox" >
                    
                    <div class="subbox active">
                        <h4>
                            <span class="tit">参考文献</span>
                            <a class="close" href="javascript:void(0)">x</a>
                        </h4>
                        <div class="side-scroller">
                            <ul class="refer-list">
                                <li id="3">


                                    <a id="bibliography_1" title=" 赵时旻.轨道交通自动售检票系统[M].同济大学出版社, 2007." target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=CBBD&amp;filename=9787560835617001&amp;v=MTM2MzJYRnF6R2JhK0h0blBxb2xFWStzUERSTTh6eFVTbURkOVNIN24zeEU5ZmJ2bktyaWZaZVp2RnlubVU3L05KRjRR&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[1]</b>
                                         赵时旻.轨道交通自动售检票系统[M].同济大学出版社, 2007.
                                    </a>
                                </li>
                                <li id="5">


                                    <a id="bibliography_2" title=" 中华人民共和国国家质量监督检验检疫总局, 中国国家标准化管理委员会.GB/T 20907-2007 城市轨道交通自动售检票系统技术条件[S].2007." target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=SCSF&amp;filename=SCSF00023911&amp;v=MzE5MzJwbzVFQys0UEQzMUx4eFlUNnpvT1MzZm1wV0ZhZTdLV1JicWVaK1J1RnkzaFU3cz1OaTdZYUxPNEh0UFA=&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[2]</b>
                                         中华人民共和国国家质量监督检验检疫总局, 中国国家标准化管理委员会.GB/T 20907-2007 城市轨道交通自动售检票系统技术条件[S].2007.
                                    </a>
                                </li>
                                <li id="7">


                                    <a id="bibliography_3" title=" 王爱英.智能卡技术:IC卡与RFID标签[M].3版.清华大学出版社, 2009." target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=CBBD&amp;filename=9787302202400001&amp;v=MjI1MTFmWmVadkZ5bm1VNy9OSkY0UVhGcXpHYkM0SE5QTXJZdEZaT3NQRFJNOHp4VVNtRGQ5U0g3bjN4RTlmYnZuS3Jp&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[3]</b>
                                         王爱英.智能卡技术:IC卡与RFID标签[M].3版.清华大学出版社, 2009.
                                    </a>
                                </li>
                                <li id="9">


                                    <a id="bibliography_4" title=" MF01CU1 Functional specification MIFARE Ultralight[Z].2010." target="_blank"
                                       href="http://scholar.cnki.net/result.aspx?q=MF01CU1 Functional specification MIFARE Ultralight">
                                        <b>[4]</b>
                                         MF01CU1 Functional specification MIFARE Ultralight[Z].2010.
                                    </a>
                                </li>
                                <li id="11">


                                    <a id="bibliography_5" title=" MIFARE Standard Card IC MF1 IC S50 Functional Specification[Z].2001." target="_blank"
                                       href="http://scholar.cnki.net/result.aspx?q=MIFARE Standard Card IC MF1 IC S50 Functional Specification">
                                        <b>[5]</b>
                                         MIFARE Standard Card IC MF1 IC S50 Functional Specification[Z].2001.
                                    </a>
                                </li>
                                <li id="13">


                                    <a id="bibliography_6" title=" ISO/IEC 14443 Identification cards—Contactless integrated circuit (s) cards—Proximity cards[S].2016." target="_blank"
                                       href="http://scholar.cnki.net/result.aspx?q=Identification cards—Contactless integrated circuit (s) cards—Proximity cards">
                                        <b>[6]</b>
                                         ISO/IEC 14443 Identification cards—Contactless integrated circuit (s) cards—Proximity cards[S].2016.
                                    </a>
                                </li>
                                <li id="15">


                                    <a id="bibliography_7" title=" 中国人民银行.中国金融集成电路 (IC) 卡规范[S].2013." target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=CBBD&amp;filename=9787504968456000&amp;v=MTg3NzNCTTh6eFVTbURkOVNIN24zeEU5ZmJ2bktyaWZaZVp2RnlubVU3L05KRjRRWEZxekdiYTRHdGpLcDR0QVl1c1BE&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[7]</b>
                                         中国人民银行.中国金融集成电路 (IC) 卡规范[S].2013.
                                    </a>
                                </li>
                                <li id="17">


                                    <a id="bibliography_8" >
                                        <b>[8]</b>
                                     中华人民共和国交通运输部.城市公共交通IC卡技术规范[S].2017.</a>
                                </li>
                                <li id="19">


                                    <a id="bibliography_9" title=" 中华人民共和国建设部.建设事业IC卡应用技术[S].2005." target="_blank"
                                       href="/kcms/detail/detail.aspx?dbcode=SCSD&amp;filename=SCSD000005042842&amp;v=MjU2ODF1TUxEaE04enhVU21EZDlTSDduM3hFOWZidm5LcmlmWmVadkZ5bm1VNy9OSkY0UU5pN1lhck80SHRITXFvOUJa&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                        <b>[9]</b>
                                         中华人民共和国建设部.建设事业IC卡应用技术[S].2005.
                                    </a>
                                </li>
                            </ul>
                            <div style='display: none;' class="zqscroller" >
                                <h4 class="">附加材料</h4>
                                <ul></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            &nbsp;
            <!--此处有一空格符 勿删-->
        </div>

        
    <div class="content">



        <!--tips start-->
                            <div class="tips">
                    <a href="http://navi.cnki.net/KNavi/JournalDetail?pcode=CJFD&amp;pykm=JYRJ" target="_blank">计算机应用与软件</a>
                2019,36(07),133-137+163 DOI:10.3969/j.issn.1000-386x.2019.07.023            </div>
        <!--tips end-->
            <div class="top-title">
                <h1 class="title">
                    <span class="vm"><b>一种城市轨道交通自动售检票系统票卡快速识别实现方法</b></span>
                                    </h1>

            </div>
                        <h2>
                                <a href="javascript:;">裴练军</a>
                </h2>
                    <h2>
                    <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=in&amp;skey=%E4%B8%8A%E6%B5%B7%E5%8D%8E%E8%99%B9%E8%AE%A1%E9%80%9A%E6%99%BA%E8%83%BD%E7%B3%BB%E7%BB%9F%E8%82%A1%E4%BB%BD%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">上海华虹计通智能系统股份有限公司</a>
            </h2>

        
<div class="link">
    <a id="aexport" class="icon icon-output"  onclick="" href="javascript:void(0);"><i></i>导出/参考文献</a>
    
    <span class="shareBoard" onmouseover="$('#sharedet').show();$('#this').addClass('shareBoardCUR')" onmouseout="$('#sharedet').hide();$('#this').removeClass('shareBoardCUR')">
        <a class="icon icon-share" href="#"><i></i>分享<em></em></a>
        <ul class="shareHide" id="sharedet" style="display: none;">
            <li><a title="复制链接" class="copy" onclick="" href="#"><i></i>复制链接</a></li>
            <li><a title="分享到新浪微博" class="xl" onclick="" href="javascript:common.ShareAction('xl');"><i></i>新浪微博</a></li>
            <li>
                <a title="分享到微信" class="wx" onclick="" href="#"><i></i>微信扫一扫</a>
                <div class="qrcode"><img src='' alt='' /></div>
            </li>
        </ul>

    </span>
    
    <a id="RefTrack" title="创建引文跟踪" class="icon icon-track" onclick="" href="javascript:void(0);"> <i></i>创建引文跟踪 </a>
    <a id="ashoucang" title="收藏" class="icon icon-favor" onclick="" href="javascript:void(0);"><i></i>收藏</a>
    <a class="icon icon-print" onclick="window.print();" href="javascript:void(0);"><i></i>打印</a>
    
    <!--版本切换 end-->
</div>
                            <div class="data" id="a_abstract">
                <span class="keys">摘<span style="font-family: 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;</span>要：</span>
                <p>根据城市轨道交通自动售检票系统中使用车票的种类, 参考国际标准和规范, 结合卡片在不同阶段的响应来区分常用的单程票、储值票。再利用MIFARE Pro卡的发行主体设计的文件结构来区分不同应用的IC卡。提出读写器程序的层级开发软件结构, 为快速响应需求提供可能, 同时也为票卡设计提供一些原则建议。</p>
            </div>
                    <div class="data" id="a_keywords">
                <span class="keys">关键词：</span>
                <p>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=MIFARE%20Classic%E7%B3%BB%E5%88%97&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">MIFARE Classic系列;</a>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=MIFARE%20Pro%E7%B3%BB%E5%88%97&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">MIFARE Pro系列;</a>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=%E8%87%AA%E5%8A%A8%E5%94%AE%E6%A3%80%E7%A5%A8%E7%B3%BB%E7%BB%9F&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">自动售检票系统;</a>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=%E8%BD%AF%E4%BB%B6%E7%BB%93%E6%9E%84&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">软件结构;</a>
                </p>
            </div>
        
        <!--brief start-->
        
            <div class="brief">
                    <p>
                            <b>作者简介：</b>
                                                        <span>
                                    裴练军, 工程师, 主研领域:城市轨道交通自动售检票系统。;
                                </span>
                    </p>
                                    <p><b>收稿日期：</b>2019-05-17</p>

            </div>
                    <h1><b>A FAST RECOGNITION METHOD OF TICKET CARDS IN AN AUTOMATIC FARE COLLECTION SYSTEM IN URBAN RAIL TRANSIT</b></h1>
                    <h2>
                    <span>Pei Lianjun</span>
            </h2>
                    <h2>
                    <span>Shanghai Huahong Jitong Smart Card System Co., Ltd.</span>
            </h2>
                            <div class="data" id="a_abstractEN">
                <span class="keys">Abstract：</span>
                <p>According to the types of tickets used in the automatic fare collection (AFC) system in urban rail transit, referring to international standards and norms, and combining the response of cards at different stages, the common single journey ticket (SJT) and the stored value ticket (SVT) can be distinguished. We used the file structure designed by the issuer of MIFARE Pro card to identify IC cards of different applications. Then we proposed hierarchical development software architecture for reader programs. It provides the possibility of rapid response to demand, and also provides some principles and suggestions for ticket card design.</p>
            </div>
                    <div class="data" id="a_keywordsEN">
                <span class="keys">Keyword：</span>
                <p>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=MIFARE%20Classic&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">MIFARE Classic;</a>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=MIFARE%20Pro&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">MIFARE Pro;</a>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=Automatic%20fare%20collection%20(AFC)%20&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">Automatic fare collection (AFC) ;</a>
                        <a href="/kcms/detail/knetsearch.aspx?dbcode=CJFD&amp;sfield=kw&amp;skey=Software%20structure&amp;code=&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" target="_blank">Software structure;</a>
                </p>
            </div>
                    <div class="brief">
                
                    <p>
                                            </p>
                                    <p><b>Received：</b> 2019-05-17</p>
                            </div>


        <!--brief start-->
                        <h3 id="21" name="21" class="anchor-tag"><b>0 引 言</b></h3>
                <div class="p1">
                    <p id="22">随着我国城市化进程的进一步加快和城市规模的逐步扩大, 城市轨道交通已成为大中型城市最重要的基础交通设施之一<citation id="127" type="reference"><link href="3" rel="bibliography" /><sup>[<a class="sup">1</a>]</sup></citation>。</p>
                </div>
                <div class="p1">
                    <p id="23">城市轨道交通自动售检票系统是现代化的收费系统, 一般采用五层架构:第一层为城市轨道交通票务清分系统, 第二层为线路中央计算机系统, 第三层为车站计算机系统, 第四层为车站终端设备, 第五层为车票。乘客可通过售票、检票设备实现关于车票票务的自助服务, 最终在票务清分系统实现各运营商的收益分配<citation id="128" type="reference"><link href="5" rel="bibliography" /><sup>[<a class="sup">2</a>]</sup></citation>。</p>
                </div>
                <div class="p1">
                    <p id="24">作为城市轨道交通自动售检票系统的第五层——车票层, 轨道交通售检票系统支持的票卡类型有很多。储值类票一般分单程票、储值票和二维码支付等。储值票遵循的标准一般可分为地铁自发一票通卡、住建部一卡通卡、交通部一卡通卡和银行卡支付等。除二维码外, 其他车票类型均为非接触式IC卡<citation id="129" type="reference"><link href="7" rel="bibliography" /><sup>[<a class="sup">3</a>]</sup></citation>, 非接触式IC卡是城市轨道交通自动售检票系统中的常规基础票卡类型。不同类型的票卡同时在检票机上使用, 这样的应用场景决定了终端设备须快速识别车票类型, 并予以处理。</p>
                </div>
                <div class="p1">
                    <p id="25">近年来, 全国各地城市轨道自动售检票接入“互联网+”得到了大力发展, 快速培养新一代的熟悉非接触式IC卡的开发人员任务越来越紧迫;与此同时, 基于非接触式IC卡的公共交通行业优惠应用也督促开发商和开发人员需要响应快速。</p>
                </div>
                <h3 id="26" name="26" class="anchor-tag"><b>1 现状分析</b></h3>
                <div class="p1">
                    <p id="27">城市轨道交通是一种大运量交通运输系统, 自动售检票系统须适应客流密集的进、出站需求。目前, 轨道交通领域使用的非接触式IC卡种类较多, 为了识别和区分, 现常用的方法包括有:常量值法和命令重试法。</p>
                </div>
                <div class="p1">
                    <p id="28">常量值法是指根据特定命令返回的常量值, 标记不同车票介质的类别。采用常量值法可在车票种类较少时可快速区分不同的车票种类, 但在自动售检票系统支持较多票卡供应商、较多发行方的车票时往往导致识别重试增多。</p>
                </div>
                <div class="p1">
                    <p id="29">命令重试法是指尝试发送不同票卡的交易指令, 以是否获得成功应答的方式来识别票卡。这种方式将导致交易时间过长, 从而延长了整个的交易流程时间。</p>
                </div>
                <div class="p1">
                    <p id="30">随着技术发展, 轨道交通售检票终端设备已从单片机向嵌入式操作系统扩展。在传统的开发环境下, 票卡处理业务应用与射频驱动应用是紧密耦合在一起, 开发人员既需要了解硬件设计、掌握射频驱动, 又需要关注业务需求, 并将两者紧密结合在一起完成应用软件开发。这种开发方式既对开发人员提出了很高的要求, 也不能快速响应业务变化的外部需求。</p>
                </div>
                <div class="p1">
                    <p id="31">因此, 通过分析票卡的物理特性, 参考ISO-14443国际标准来识别票卡, 归纳出层级软件开发架构不失为一种解决方法。</p>
                </div>
                <h3 id="32" name="32" class="anchor-tag"><b>2 票卡物理介质</b></h3>
                <div class="p1">
                    <p id="33">在轨道交通领域使用的非接触式IC卡物理介质主要包括有基于MIFARE Ultralight的单程票、基于MIFARE Classic的储值票和基于MIFARE Pro卡的储值票。目前, 基于MIFARE Pro卡的储值票成为应用主流。</p>
                </div>
                <h4 class="anchor-tag" id="34" name="34"><b>2.1 单程票</b></h4>
                <div class="p1">
                    <p id="35">MIFARE Ultralight卡是一种小容量、符合ISO1443-A的存储车票。Ultralight车票有以下典型特点<citation id="130" type="reference"><link href="9" rel="bibliography" /><sup>[<a class="sup">4</a>]</sup></citation>:</p>
                </div>
                <div class="p1">
                    <p id="36">1) 具有7个字节唯一物理卡号;</p>
                </div>
                <div class="p1">
                    <p id="37">2) 具有4字节OTP;</p>
                </div>
                <div class="p1">
                    <p id="38">3) 一般容量512位, 分为16个page, 每个page为4个字节;</p>
                </div>
                <div class="p1">
                    <p id="39">4) 具有Lock锁功能, 可对关键数据区进行锁;</p>
                </div>
                <div class="p1">
                    <p id="40">5) 数据区可任意读、写。</p>
                </div>
                <div class="p1">
                    <p id="41">MIFARE Ultralight卡本身不具备逻辑判断功能, 在轨道交通应用时一般作为循环使用、面值不高的单程票。</p>
                </div>
                <div class="p1">
                    <p id="42">MIFARE Ultralight卡的存储结构如图1所示。</p>
                </div>
                <div class="area_img" id="43">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JYRJ201907024_043.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图1 MIFARE Ultralight卡存储结构图" src="Detail/GetImg?filename=images/JYRJ201907024_043.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图1 MIFARE Ultralight卡存储结构图  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JYRJ201907024_043.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit"></p>

                </div>
                <h4 class="anchor-tag" id="44" name="44"><b>2.2 MIFARE Classic卡</b></h4>
                <div class="p1">
                    <p id="45">MIFARE Classic卡是一种广泛应用的非接触式IC卡, 包括MIFARE S50、MIFARE S70等, 常用来作为储值卡使用。在轨道交通领域常使用是MIFARE Classic卡是1 KB容量、符合ISO14443-A<citation id="131" type="reference"><link href="11" rel="bibliography" /><sup>[<a class="sup">5</a>]</sup></citation>。</p>
                </div>
                <div class="p1">
                    <p id="46">MIFARE Classic具有以下特点:</p>
                </div>
                <div class="p1">
                    <p id="47">1) 具有4个字节的唯一物理序列号;</p>
                </div>
                <div class="p1">
                    <p id="48">2) 每个块有16个字节, 4个块组成一个扇区。1 KB容量的共有16个扇区;</p>
                </div>
                <div class="p1">
                    <p id="49">3) 每个扇区可独立设置读、写权限, 只有认证通过才可对本扇区的块进行读、写操作;</p>
                </div>
                <div class="p1">
                    <p id="50">4) 扇区可分为数据区和值区, 值区一般用于存储卡片金额数据。</p>
                </div>
                <div class="p1">
                    <p id="51">MIFARE Classic卡本身具有逻辑判断功能, 但没有逻辑计算功能。在初次通信时须进行三重认证, 之后的交互数据以加密形式进行, 从而防止截取报文数据以促进安全性。</p>
                </div>
                <div class="p1">
                    <p id="52">典型的MIFARE Classic卡的存储结构如图2所示。</p>
                </div>
                <div class="area_img" id="53">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JYRJ201907024_053.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图2 MIFARE Classic卡存储结构图" src="Detail/GetImg?filename=images/JYRJ201907024_053.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图2 MIFARE Classic卡存储结构图  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JYRJ201907024_053.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit"></p>

                </div>
                <h4 class="anchor-tag" id="54" name="54"><b>2.3 MIFARE Pro卡</b></h4>
                <div class="p1">
                    <p id="55">MIFARE Pro卡是指卡片内含微处理器、存储单元和芯片操作系统的具有逻辑处理能力的集成电路卡, 一般称为CPU卡。CPU卡是将密钥安全存储在卡片内, 在实际使用中自身进行逻辑计算来确定合法性, 极大提高了卡片的安全。</p>
                </div>
                <div class="p1">
                    <p id="56">CPU卡具备有以下特点:</p>
                </div>
                <div class="p1">
                    <p id="57">1) 具有4字节的唯一物理编号;</p>
                </div>
                <div class="p1">
                    <p id="58">2) 具有硬件DES/3DES协处理器;</p>
                </div>
                <div class="p1">
                    <p id="59">3) 具有硬件真随机数发生器;</p>
                </div>
                <div class="p1">
                    <p id="60">4) 以文件、目录形式定义存储结构, 以目录进行安全隔离;</p>
                </div>
                <div class="p1">
                    <p id="61">5) 空间容量大。一般常用的有8 KB空间, 目前已达到128 KB。</p>
                </div>
                <div class="p1">
                    <p id="62">由于CPU卡内具有操作系统, 典型的CPU卡存储结构如图3所示。</p>
                </div>
                <div class="area_img" id="63">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JYRJ201907024_063.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图3 CPU卡存储结构图" src="Detail/GetImg?filename=images/JYRJ201907024_063.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图3 CPU卡存储结构图  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JYRJ201907024_063.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit"></p>

                </div>
                <h3 id="64" name="64" class="anchor-tag"><b>3 与票卡的交互流程</b></h3>
                <div class="p1">
                    <p id="65">无论MIFARE Ultralight卡、MIFARE Classic卡或MIFARE Pro卡, 在轨道交通领域都是作为非接触式IC卡来使用, 通过射频完成数据交互。不同的IC卡交互流程有所不同, 操作命令不同, 但均遵循ISO-14443国际标准。</p>
                </div>
                <div class="p1">
                    <p id="66">典型的交互流程分为以下三种。</p>
                </div>
                <h4 class="anchor-tag" id="67" name="67"><b>3.1 寻卡流程</b></h4>
                <div class="p1">
                    <p id="68">非接触式IC卡经过寻卡 (request) 、防冲突 (anti-collision) 和选择 (select) 交互命令进入数据交互过程, 确保了交互过程的唯一性<citation id="132" type="reference"><link href="13" rel="bibliography" /><sup>[<a class="sup">6</a>]</sup></citation>。非接触式IC卡寻卡流程如图4所示。</p>
                </div>
                <div class="area_img" id="69">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JYRJ201907024_069.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图4 非接触式IC卡寻卡流程图" src="Detail/GetImg?filename=images/JYRJ201907024_069.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图4 非接触式IC卡寻卡流程图  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JYRJ201907024_069.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit"></p>

                </div>
                <div class="p1">
                    <p id="70">由于MIFARE Ultralight卡具有7字节的唯一长度, 须进行二次防冲突和二次选择后进入数据交互过程。而MIFARE Classic卡和MIFARE Pro卡具有4字节的唯一长度, 只须一次防冲突和选择卡后进入后续的操作过程。</p>
                </div>
                <h4 class="anchor-tag" id="71" name="71"><b>3.2 MIFARE Classic操作</b></h4>
                <div class="p1">
                    <p id="72">MIFARE Classic卡不支持ISO-14443-4的协议, 在选择 (select) 卡片后进行三重认证完成加密握手, 然后根据相应的命令完成操作:</p>
                </div>
                <div class="p1">
                    <p id="73">1) 对于数据区可使用读块、写块命令;</p>
                </div>
                <div class="p1">
                    <p id="74">2) 对于值区可使用加值、减值、恢复等命令, 确认后进行传递完成;</p>
                </div>
                <div class="p1">
                    <p id="75">3) 对MIFARE Classic卡的操作以块为基础单位进行。</p>
                </div>
                <div class="p1">
                    <p id="76">MIFARE Classic卡操作命令流程如图5所示。</p>
                </div>
                <div class="area_img" id="77">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JYRJ201907024_077.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图5 MIFARE Classic卡操作命令流程图" src="Detail/GetImg?filename=images/JYRJ201907024_077.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图5 MIFARE Classic卡操作命令流程图  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JYRJ201907024_077.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit"></p>

                </div>
                <h4 class="anchor-tag" id="78" name="78"><b>3.3 MIFARE Pro卡操作</b></h4>
                <div class="p1">
                    <p id="79">MIFARE Pro卡支持ISO14443-4的协议。由于MIFARE Pro卡容量大、数据交互量大。须发送RATS以交换双方的特性信息, 包括是否支持PPS以更快速的进行数据交互;设置、获取FWT值以确定后续数据接收、传输缓存大小等特性。</p>
                </div>
                <div class="p1">
                    <p id="80">RATS命令后所有CPU卡的操作称为APDU (Application Protocol Data Unit) 命令。APDU命令在空中可读取, 所以称为交换透明数据。正如之前所述, CPU卡的安全性依赖于CPU卡的逻辑计算处理能力, 而不需要对空中数据进行加密传输。</p>
                </div>
                <div class="p1">
                    <p id="81">MIFARE Pro卡操作命令流程如图6所示。</p>
                </div>
                <div class="area_img" id="82">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JYRJ201907024_082.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图6 MIFARE Pro卡操作命令流程图" src="Detail/GetImg?filename=images/JYRJ201907024_082.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图6 MIFARE Pro卡操作命令流程图  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JYRJ201907024_082.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit"></p>

                </div>
                <h3 id="83" name="83" class="anchor-tag"><b>4 车票的使用</b></h3>
                <div class="p1">
                    <p id="84">在实际轨道交通自动售检票系统应用中, 上述几种类型的车票都有可能使用, 且会有不同的供应商供货。不同的车票物理介质其交互使用的命令接口不同, 同是CPU卡物理介质的车票, 其文件、目录也会随发行方的设计有所不同。因此, 根据实际应用区分不同介质的车票, 尤其是区分不同的发行主体的CPU介质车票是轨道交通应用的首要解决的问题。</p>
                </div>
                <h4 class="anchor-tag" id="85" name="85"><b>4.1 对票卡物理介质的识别</b></h4>
                <div class="p1">
                    <p id="86">Request命令的应答值定义如图7所示。</p>
                </div>
                <div class="area_img" id="87">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JYRJ201907024_087.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图7 寻卡 (Request) 命令应答值定义" src="Detail/GetImg?filename=images/JYRJ201907024_087.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图7 寻卡 (Request) 命令应答值定义  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JYRJ201907024_087.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit"></p>

                </div>
                <div class="p1">
                    <p id="88">其中的b7、b8两位表示卡号的长度, 含义分别为:00b表示4字节的长度;01b表示7字节的长度;10b表示10字节的卡号, 11b预留<citation id="133" type="reference"><link href="13" rel="bibliography" /><sup>[<a class="sup">6</a>]</sup></citation>。因此, 根据Request的应答数据首先可以区分出MIFARE Ultralight卡, 然后根据Ultralight卡命令执行后续操作。</p>
                </div>
                <div class="p1">
                    <p id="89">Select命令的应答值定义如图8所示。</p>
                </div>
                <div class="area_img" id="90">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JYRJ201907024_090.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图8 选择卡 (Select) 命令应答值定义" src="Detail/GetImg?filename=images/JYRJ201907024_090.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图8 选择卡 (Select) 命令应答值定义  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JYRJ201907024_090.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit"></p>

                </div>
                <div class="p1">
                    <p id="91">其中的b6和b3位组合起来:10b表示唯一卡号完整, 且符合ISO14443-4;00b表示唯一卡号完整, 但不符合ISO14443-4。同时, 若b3位值为1时, 则说明卡片物理卡号不完全, 还需要再次防冲突和选择卡<citation id="134" type="reference"><link href="13" rel="bibliography" /><sup>[<a class="sup">6</a>]</sup></citation>。</p>
                </div>
                <div class="p1">
                    <p id="92">MIFARE Classic卡不支持ISO14443-4协议, 因此可根据Select的应答区分出MIFARE Classic卡, 然后根据MIFARE Classic卡命令执行后续操作。</p>
                </div>
                <div class="p1">
                    <p id="93">所有不符合上述的流程判断的卡, 可认为是MIFARE Pro卡。</p>
                </div>
                <div class="p1">
                    <p id="94">完整的区分识别MIFARE Ultralight、MIFARE Classic卡和MIFARE Pro卡的流程如图9所示。</p>
                </div>
                <div class="area_img" id="95">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JYRJ201907024_095.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图9 区分MIFARE Ultralight、MIFARE Classic 和MIFARE Pro流程图" src="Detail/GetImg?filename=images/JYRJ201907024_095.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图9 区分MIFARE Ultralight、MIFARE Classic 和MIFARE Pro流程图  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JYRJ201907024_095.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit"></p>

                </div>
                <h4 class="anchor-tag" id="96" name="96"><b>4.2 对MIFARE Pro卡的识别</b></h4>
                <div class="p1">
                    <p id="97">在轨道交通自动售检票系统中应用的CPU卡, 除了地铁自身发行的IC卡外, 还有符合住建部IC卡服务中心标准的一卡通、符合交通部标准的一卡通、符合银联标准的银行卡, 以及其他系统发行的但不允许在地铁使用的CPU卡。因此在识别出CPU卡后, 还需要进一步区分CPU卡的发行主体。</p>
                </div>
                <div class="p1">
                    <p id="98">CPU卡的存储结构为文件、目录, 因此可利用目录名、文件名以及文件内容来进行区分。比如, 交通部和银联均要求其应用须在PPSE的支付环境下, 可通过选择PPSE的返回值来确定是否为交通部卡;住建部IC卡服务中心标准的AID值为唯一值, 可通过其确认是否为符合住建部标准的一卡通;其他发卡方可以在设计时, 通过约定其中某一个文件的值来定义区分。</p>
                </div>
                <div class="p1">
                    <p id="99">综上所述, CPU卡的区分发行主体须根据具体的应用环境进行设计、识别。以某城市地铁的应用为例, 该城市地铁CPU卡的应用流程如图10所示。</p>
                </div>
                <div class="area_img" id="100">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JYRJ201907024_100.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图10 某城市地铁CPU卡应用流程" src="Detail/GetImg?filename=images/JYRJ201907024_100.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图10 某城市地铁CPU卡应用流程  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JYRJ201907024_100.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit"></p>

                </div>
                <h4 class="anchor-tag" id="101" name="101"><b>4.3 票卡应用优化法测试</b></h4>
                <div class="p1">
                    <p id="102">使用华虹计通公司生产的DTD-3018型读写器进行寻卡时间测试。测试时间为通过命令可确定车票物理介质为止。</p>
                </div>
                <div class="p1">
                    <p id="103">尝试法寻卡按照优先MIFARE Pro卡, 其次MIFARE Classic卡, 最后MIFARE Ultralight卡的来测试其寻卡的时间, 如表1所示。</p>
                </div>
                <div class="area_img" id="104">
                    <p class="img_tit"><b>表1 尝试法寻卡时间表</b> <a class="downexcel" onclick="DownLoadReportExcel(this)">导出到EXCEL</a></p>
                    <p class="img_tit"></p>
                    <p class="img_note"> ms</p>
                    <table id="104" border="1"><tr><td>      次数<br />顺序</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td><td>平均</td></tr><tr><td><br />MIFARE<br /> Pro</td><td>27</td><td>27</td><td>27</td><td>27</td><td>27</td><td>27</td><td>27</td><td>28</td><td>27</td><td>26</td><td>27</td></tr><tr><td><br />MIFARE<br /> Classic</td><td>70</td><td>70</td><td>70</td><td>70</td><td>70</td><td>71</td><td>70</td><td>70</td><td>70</td><td>71</td><td>70</td></tr><tr><td><br />MIFARE<br /> Ultralight</td><td>93</td><td>93</td><td>92</td><td>92</td><td>92</td><td>92</td><td>92</td><td>92</td><td>92</td><td>92</td><td>92</td></tr></table>
                    <form name="form" action="/kxreader/Detail/DownloadReportExcel" method="POST" style="display:inline">
                        <input type="hidden" name="hidTable" value="" />
                        <input type="hidden" name="hidFileName" value="" />
                    </form>
                    <p class="img_note"></p>
                    <p class="img_note"></p>
                </div>
                <div class="p1">
                    <p id="105">针对同样的卡使用优化方法进行寻卡时间测试, 如表2所示。</p>
                </div>
                <div class="area_img" id="106">
                    <p class="img_tit"><b>表2 优化后寻卡时间表</b> <a class="downexcel" onclick="DownLoadReportExcel(this)">导出到EXCEL</a></p>
                    <p class="img_tit"></p>
                    <p class="img_note"> ms</p>
                    <table id="106" border="1"><tr><td>      次数<br />顺序</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td><td>平均</td></tr><tr><td><br />MIFARE<br /> Pro</td><td>27</td><td>27</td><td>27</td><td>25</td><td>27</td><td>27</td><td>25</td><td>27</td><td>27</td><td>27</td><td>27</td></tr><tr><td><br />MIFARE<br /> Classic</td><td>38</td><td>39</td><td>39</td><td>39</td><td>38</td><td>38</td><td>38</td><td>35</td><td>38</td><td>38</td><td>38</td></tr><tr><td><br />MIFARE<br /> Ultralight</td><td>36</td><td>36</td><td>36</td><td>36</td><td>35</td><td>33</td><td>35</td><td>35</td><td>36</td><td>34</td><td>36</td></tr></table>
                    <form name="form" action="/kxreader/Detail/DownloadReportExcel" method="POST" style="display:inline">
                        <input type="hidden" name="hidTable" value="" />
                        <input type="hidden" name="hidFileName" value="" />
                    </form>
                    <p class="img_note"></p>
                    <p class="img_note"></p>
                </div>
                <div class="p1">
                    <p id="107">从测试结果可以看出, 尝试法寻卡时间与确定车票物理介质的先后顺序相关联, 首先确认的车票其寻卡时间更快, 而优化后的寻卡时间与车票的介质不相关, 提高了车票寻卡确定速度。</p>
                </div>
                <h3 id="108" name="108" class="anchor-tag"><b>5 系统架构</b></h3>
                <div class="p1">
                    <p id="109">通过上述对卡的快速识别的整理, 提出读写器软件开发过程层级开发架构概念, 使读写器的业务集中在应用层, 而与射频的交互由底层驱动完成。</p>
                </div>
                <div class="p1">
                    <p id="110">典型的软件系统结构设计如图11所示。</p>
                </div>
                <div class="area_img" id="111">
                                <a class="zoom-in" href="Detail/GetImg?filename=images/JYRJ201907024_111.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">
                                    <img alt="图11 读写器内软件系统结构示意图" src="Detail/GetImg?filename=images/JYRJ201907024_111.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
                                </a>
                                <p class="img_tit">图11 读写器内软件系统结构示意图  <a class="btn-zoomin" href="Detail/GetImg?filename=images/JYRJ201907024_111.jpg&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!"></a><a class="downimg">&nbsp;&nbsp;下载原图</a></p>
                            <p class="img_tit"></p>

                </div>
                <div class="p1">
                    <p id="112">在识别车票种类后, 采取业务与硬件分离统一对射频的调用接口, 并按照ISO-14443的卡片交互流程定义了相应的函数接口, 使应用层开发直接面向应用开发。例如:</p>
                </div>
                <div class="p1">
                    <p id="113">寻卡、防冲突、选择卡相应的函数定义:</p>
                </div>
                <div class="p1">
                    <p id="114">UBYTE mcml_request (UBYTE request_type, UBYTE*atq) ;</p>
                </div>
                <div class="p1">
                    <p id="115">UBYTE mcml_anticoll (UBYTE*psnr) ;</p>
                </div>
                <div class="p1">
                    <p id="116">UBYTE mcml_select (UBYTE*psnr, UBYTE*status) ;</p>
                </div>
                <div class="p1">
                    <p id="117">读、写MIFARE Ultralight的信息函数:</p>
                </div>
                <div class="p1">
                    <p id="118">UBYTE UL_Page_Read (UBYTE addr, UBYTE*pReaddata) ;</p>
                </div>
                <div class="p1">
                    <p id="119">UBYTE UL_Page_Write (UBYTE addr, UBYTE*pWritedata) ;</p>
                </div>
                <div class="p1">
                    <p id="120">ISO-14443-4的交换透明数据接口函数:</p>
                </div>
                <div class="p1">
                    <p id="121">UBYTE mifpro_icmd (UBYTE*inbuf, UBYTE inbytes, UBYTE*outbuf, UWORD*outbytes) ;</p>
                </div>
                <h3 id="122" name="122" class="anchor-tag"><b>6 结 语</b></h3>
                <div class="p1">
                    <p id="123">随着新建城市轨道交通的扩展, 快速响应城市轨道交通自动售检票系统的应用面临更紧迫的需求。与此同时, 既有已开通轨道交通的城市也面临接入更多票卡的需求。本文通过对轨道交通大量使用的各种介质车票的分析, 参照ISO-14443规范的角度提出了识别车票的一种方法, 进而优化了交易时间的处理。</p>
                </div>
                <div class="p1">
                    <p id="124">针对轨道交通自动售检票系统使用的储值类车票进行进一步分析, 提出了一种根据专用AID标识识别的方式, 更进一步建议车票设计时的相互协调的方法, 使得在满足业务的情况下, 加快车票的交易处理时间。</p>
                </div>
                <div class="p1">
                    <p id="125">最后, 针对新一代的开发环境, 将原来紧密耦合射频驱动、业务处理的软件开发变更为层级式开发, 并提出了基于嵌入式系统读写器层级软件开发结构, 使参与读写器的不同开发人员关注其重点方面, 最终使对车票的处理转向对业务的分析、处理, 更加灵活地适应变化的轨道交通业务需求, 加快了开发速度, 增强了产品的稳定性。</p>
                </div>
                <div class="p1">
                    <p id="126">在宁波轨道自动售检票系统中增加符合交通部标准的一卡通、符合银联标准的银行卡功能应用时, 使用票卡快速识别方法保证了不影响既有的MIFARE Ultralight卡、MIFARE Classic卡的交易速度, 又可快速识别各发行主体的CPU卡。同时, 利用层级式开发方法在宁波轨道应用公共交通换乘优惠时, 使开发人员重点关注优惠规则的业务实现, 快速响应了客户的需求。</p>
                </div>

        <!--brief end-->
        
        <!--conten left  end-->
        <!--增强附件-->
        

        <!--reference start-->
            <div class="reference anchor-tag" id="a_bibliography">
                    <h3>参考文献</h3>
                                        <p id="3">
                            <a id="bibliography_1" target="_blank" href="/kcms/detail/detail.aspx?dbcode=CBBD&amp;filename=9787560835617001&amp;v=MDc0ODhYRnF6R2JhK0h0blBxb2xFWStzUERSTTh6eFVTbURkOVNIN24zeEU5ZmJ2bktyaWZaZVp2RnlubVU3L05KRjRR&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[1]</b> 赵时旻.轨道交通自动售检票系统[M].同济大学出版社, 2007.
                            </a>
                        </p>
                        <p id="5">
                            <a id="bibliography_2" target="_blank" href="/kcms/detail/detail.aspx?dbcode=SCSF&amp;filename=SCSF00023911&amp;v=MDM3MDdlWitSdUZ5M2hVN3M9Tmk3WWFMTzRIdFBQcG81RUMrNFBEMzFMeHhZVDZ6b09TM2ZtcFdGYWU3S1dSYnE=&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[2]</b> 中华人民共和国国家质量监督检验检疫总局, 中国国家标准化管理委员会.GB/T 20907-2007 城市轨道交通自动售检票系统技术条件[S].2007.
                            </a>
                        </p>
                        <p id="7">
                            <a id="bibliography_3" target="_blank" href="/kcms/detail/detail.aspx?dbcode=CBBD&amp;filename=9787302202400001&amp;v=MzExMzluM3hFOWZidm5LcmlmWmVadkZ5bm1VNy9OSkY0UVhGcXpHYkM0SE5QTXJZdEZaT3NQRFJNOHp4VVNtRGQ5U0g3&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[3]</b> 王爱英.智能卡技术:IC卡与RFID标签[M].3版.清华大学出版社, 2009.
                            </a>
                        </p>
                        <p id="9">
                            <a id="bibliography_4" target="_blank" href="http://scholar.cnki.net/result.aspx?q=MF01CU1 Functional specification MIFARE Ultralight">

                                <b>[4]</b> MF01CU1 Functional specification MIFARE Ultralight[Z].2010.
                            </a>
                        </p>
                        <p id="11">
                            <a id="bibliography_5" target="_blank" href="http://scholar.cnki.net/result.aspx?q=MIFARE Standard Card IC MF1 IC S50 Functional Specification">

                                <b>[5]</b> MIFARE Standard Card IC MF1 IC S50 Functional Specification[Z].2001.
                            </a>
                        </p>
                        <p id="13">
                            <a id="bibliography_6" target="_blank" href="http://scholar.cnki.net/result.aspx?q=Identification cards—Contactless integrated circuit (s) cards—Proximity cards">

                                <b>[6]</b> ISO/IEC 14443 Identification cards—Contactless integrated circuit (s) cards—Proximity cards[S].2016.
                            </a>
                        </p>
                        <p id="15">
                            <a id="bibliography_7" target="_blank" href="/kcms/detail/detail.aspx?dbcode=CBBD&amp;filename=9787504968456000&amp;v=MDA3MjREQk04enhVU21EZDlTSDduM3hFOWZidm5LcmlmWmVadkZ5bm1VNy9OSkY0UVhGcXpHYmE0R3RqS3A0dEFZdXNQ&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[7]</b> 中国人民银行.中国金融集成电路 (IC) 卡规范[S].2013.
                            </a>
                        </p>
                        <p id="17">
                            <a id="bibliography_8" >
                                    <b>[8]</b>
                                 中华人民共和国交通运输部.城市公共交通IC卡技术规范[S].2017.
                            </a>
                        </p>
                        <p id="19">
                            <a id="bibliography_9" target="_blank" href="/kcms/detail/detail.aspx?dbcode=SCSD&amp;filename=SCSD000005042842&amp;v=MTI3MjhVNy9OSkY0UU5pN1lhck80SHRITXFvOUJadU1MRGhNOHp4VVNtRGQ5U0g3bjN4RTlmYnZuS3JpZlplWnZGeW5t&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">

                                <b>[9]</b> 中华人民共和国建设部.建设事业IC卡应用技术[S].2005.
                            </a>
                        </p>
            </div>
        <!--reference end-->
        <!--footnote start-->
        <!--footnote end-->



    </div>

        <input id="fileid" type="hidden" value="JYRJ201907024" />
        <input id="dpi" type="hidden" value="600" />
    </div>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?6e967eb120601ea41b9d312166416aa6";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

    


<input id="hid_uid" name="hid_uid" type="hidden" value="WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" />
<input id="hid_kLogin_headerUrl" name="hid_kLogin_headerUrl" type="hidden" value="/KLogin/Request/GetKHeader.ashx%3Fcallback%3D%3F" />
<input id="hid_kLogin_footerUrl" name="hid_kLogin_footerUrl" type="hidden" value="/KLogin/Request/GetKFooter.ashx%3Fcallback%3D%3F" />
<div class="btn-link" style="display: none"><a target="_blank" href="/kcms/detail/detail.aspx?dbcode=CJFD&amp;filename=JYRJ201907024&amp;v=MjkyNjBGckNVUjdxZlp1WnRGeWpnVjcvTUx6VFpaTEc0SDlqTXFJOUhZSVFLREg4NHZSNFQ2ajU0TzN6cXFCdEc=&amp;uid=WEEvREcwSlJHSldRa1FhdkJtNEYxa3hKZG9XL1JrZXNhdGVWVEdvM0tSMD0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!">知网节</a></div>
<div class="popflow" id="popupTips" style="display: none;">
    <div class="popflowArr"></div>
    <div class="popflowCot">
        <div class="hd"><a href="javascript:void(0);" onclick="$('#popupTips').hide();$('#popupmsg').html('')" class="close">X</a></div>
        <div class="bd">
            <p class="mes" id="popupmsg" name="popupmsg"></p>
          
        </div>
    </div>
</div>
<input type="hidden" id="myexport" value="//kns.cnki.net" />

<input type="hidden" id="KPCAPIPATH" value="//ishufang.cnki.net" />
<input type="hidden" id="CitedTimes" value="" />
<div class="link" id="GLSearch" style="display: none;">
    <i class="icon-trangle"></i>
    <div class="inner">
        <a class="icon" id="copytext">复制</a>
        <a class="icon" target="_blank" onclick="searchCRFD(this)">工具书搜索</a>
    </div>
</div>




<input id="hidVirtualPath" name="hidVirtualPath" type="hidden" value="/kxreader" />
<script src="/kxreader/bundles/detail?v=-ULdk-c6FkZHtJA2KAXPgHnyA8mtgyPnBde_C2VZ2BY1"></script>

<script src="/kxreader/Scripts/layer.min.js" type="text/javascript"></script>

<div id="footerBox" class="rootw footer">
</div>
<script>
    if (typeof FlushLogin == 'function') {
        FlushLogin();
    }
    modifyEcpHeader(true);
</script>

<!--图片放大功能 start-->
<script src="/kxreader/bundles/imagebox?v=W4phPu9SNkGcuPeJclikuVE3PpRyIW_gnfjm_19nynI1"></script>

<script type="text/javascript">
    $(function () {
        var j = $.noConflict();
        j(function () {
            j(".zoom-in,.btn-zoomin").imgbox({
                'alignment': 'center',
                'allowMultiple': false,
                'overlayShow': true
            });
        })
    });
</script>
<!--图片放大功能 end-->
<div class="fixedbar">
    <div class="backtop hiddenV" id="backtop">
        <a id="backTopSide" href="javascript:scroll(0,0);" title=""></a>
    </div>
</div>
<script type="text/javascript" src="/kxreader/Scripts/MathJax-2.6-latest/MathJax.js?config=MML_HTMLorMML-full"></script>

</body>
</html>
